<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/blog/lib/animate-css/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rcore-os.github.io","root":"/blog/","scheme":"Muse","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="rcore-os Blog">
<meta property="og:url" content="http://rcore-os.github.io/blog/page/16/index.html">
<meta property="og:site_name" content="rcore-os Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="rcore-os Group">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rcore-os.github.io/blog/page/16/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>rcore-os Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">rcore-os Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rcore-os Group</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">527</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">497</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content index posts-expand">
          
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/18/2024%E5%B9%B4%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93-%E5%8D%93%E5%A0%82%E8%B6%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/18/2024%E5%B9%B4%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93-%E5%8D%93%E5%A0%82%E8%B6%8A/" class="post-title-link" itemprop="url">2024年开源操作系统训练营第一第二阶段学习总结-卓堂越</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-18 15:22:54" itemprop="dateCreated datePublished" datetime="2024-05-18T15:22:54+00:00">2024-05-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-11 07:51:25" itemprop="dateModified" datetime="2024-11-11T07:51:25+00:00">2024-11-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5/" itemprop="url" rel="index"><span itemprop="name">2024春夏季开源操作系统训练营</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2024年开源操作系统训练营第一阶段学习总结-卓堂越"><a href="#2024年开源操作系统训练营第一阶段学习总结-卓堂越" class="headerlink" title="2024年开源操作系统训练营第一阶段学习总结-卓堂越"></a>2024年开源操作系统训练营第一阶段学习总结-卓堂越</h1><p>首先，我要衷心感谢所有给予我帮助助教导师。每次我有困惑的时候他们的专业知识和耐心指导帮我解决一系列棘手的问题。通过这个平台可以很好的交到对这方面感兴趣的朋友，在群里跟朋友们讨论让我可以更好地理解和应用 Rust 语法。此外，也离不开Rust 社区分享的宝贵的学习资料。同时课堂上分享的The Rust Reference 不失为一本经典巨作给我前期的语法学习提供很有力的帮助。<br>在开始开发操作系统之前，先熟悉 Rust 语言的基础知识，包括语法、类型系统、所有权和生命周期等概念为首要目标。选择Rust是因为他的安全性和性能使其成为编写操作系统的理想选择。在正式做练习之前花了很多时间在环境配置上面，之前学过的harmony os 都是他们给的镜像直接导入，第一次在上面搭建问了很多导师问题，他们都耐心的回答我，让我在这方面更有兴趣。比如在当推送本地更改时，如果远程仓库已经有了更新，可能会出现合并冲突，需要手动解决这些冲突。通过这些学习能更好的完成后面几个阶段的学习。<br>和其他语言对比在生命周期这个方面Rust 强制使用生命周期来检查引用的有效性，以避免悬空引用和数据竞争。生命周期注解使得 Rust 的借用系统变得更加严格和安全。C++ 中也有生命周期的概念，但它通常通过使用智能指针、RAII（资源获取即初始化）等技术。相比rust在这方面更不容易出错。而且在所有权上面Rust 引入了所有权和借用的概念，这是与 C++ 最明显的区别之一。在 Rust 中，每个值都有一个所有者，并且在任何时候只能有一个可变借用或任意数量的不可变借用。这确保了在编译时不会出现数据竞争。在以前学过的 C++ 中，没有类似的所有权和借用系统，开发人员需要手动管理内存和资源，这可能导致内存泄漏、悬空指针和其他常见的错误</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let result;</span><br><span class="line">    &#123;</span><br><span class="line">        let x &#x3D; 5;</span><br><span class="line">        result &#x3D; compute(&amp;x);</span><br><span class="line">    &#125;</span><br><span class="line">    println!(&quot;Result: &#123;&#125;&quot;, result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn compute&lt;&#39;a&gt;(value: &amp;&#39;a i32) -&gt; &amp;&#39;a i32 &#123;</span><br><span class="line">    value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有一个 main 函数，它调用了一个 compute 函数来计算一个整数的引用，并将结果赋值给 result 变量。然后我们尝试在 main 函数中打印 result 的值。然而，compute 函数返回了一个指向局部变量 x 的引用，而 x 的生命周期只在包含它的代码块内有效。由于 x 在 compute 函数返回后就会被销毁，所以返回的引用将指向无效的内存，导致悬垂引用错误。后期我发现需要通过修改函数签名来指定一个更长的生命周期，或者避免返回对局部变量的引用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fn main() &#123;</span><br><span class="line">    let result;</span><br><span class="line">    &#123;</span><br><span class="line">        let x &#x3D; 5;</span><br><span class="line">        result &#x3D; compute(x);</span><br><span class="line">    &#125;</span><br><span class="line">    println!(&quot;Result: &#123;&#125;&quot;, result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn compute(value: i32) -&gt; i32 &#123;</span><br><span class="line">    value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上面代码的修改这样就避免了使用引用并返回了整数值本身，从而避免了悬垂引用错误。</p>
<h1 id="第二部分学习总结"><a href="#第二部分学习总结" class="headerlink" title="第二部分学习总结"></a>第二部分学习总结</h1><p>实验是按照rCore-Tutorial-Book-v3来完成的<br>环境搭建我是用了VMware 安装虚拟机在文档提供的直接使用</p>
<h2 id="lab1"><a href="#lab1" class="headerlink" title="lab1"></a>lab1</h2><p>这个任务主要是为了获取任务信息，通过引入新的系统调用 sys_task_info，操作系统增强了对任务的监控和管理能力。现在，系统管理员可以根据任务 ID 查询到任务的详细信息，包括当前任务的状态、已经执行的系统调用及其调用次数，以及任务的总运行时长。这个功能使得系统能够更加细致地了解任务的运行情况，有助于优化系统资源的分配，提高系统的整体性能和稳定性。同时，对于开发人员来说，这也提供了一个更好的调试工具，可以更方便地跟踪和分析任务的行为，帮助定位和解决潜在的问题。</p>
<h2 id="lab2"><a href="#lab2" class="headerlink" title="lab2"></a>lab2</h2><p>sys_get_time 函数的重写，我们重新设计了获取系统时间的逻辑，使其能够适应新的系统架构。这样，我们成功恢复了获取系统时间的功能，确保系统在引入新特性的同时不影响原有功能的正常运行。sys_mmap 和 sys_munmap 系统调用的实现，则为系统增加了动态内存管理的功能。通过 sys_mmap 系统调用，我们可以在虚存中映射一段指定长度的物理内存，为进程提供所需的内存空间。而 sys_munmap 则提供了取消内存映射的功能，帮助释放不再需要的内存空间，有效管理系统资源。</p>
<h2 id="lab3"><a href="#lab3" class="headerlink" title="lab3"></a>lab3</h2><p>实现了一个完全 DIY 的系统调用 sys_spawn，用以创建一个新进程。与传统的 fork 和 execve 组合不同，sys_spawn 系统调用直接创建一个新的子进程，并使其执行指定的目标程序。这种方式更加直接，省去了复制父进程地址空间的步骤，从而提高了效率。在实现 sys_spawn 系统调用的过程中，我们需要处理一些可能的错误情况，比如无效的文件名或者系统资源不足导致的错误。通过正确处理这些错误，我们可以保证系统的稳定性和可靠性。通过这次实践作业，我们深入理解了进程创建的原理和实现方式，加深了对操作系统内核的理解。同时，也提高了我们对系统调用的理解和实现能力。</p>
<h2 id="lab4"><a href="#lab4" class="headerlink" title="lab4"></a>lab4</h2><p>在本次实践中，我们要用到三个系统调用：sys_linkat、sys_unlinkat 和 sys_stat，分别用于创建硬链接、取消链接以及查询文件状态。通过这些系统调用，我们可以实现文件系统中文件的硬链接操作，并获取文件的状态信息，从而提高文件管理的便利性和灵活性。</p>
<h2 id="lab5"><a href="#lab5" class="headerlink" title="lab5"></a>lab5</h2><p>本次实验旨在实现一个新的系统调用 <code>sys_eventfd2</code>，用于在 Linux 系统中创建 eventfd，其功能是创建一个带有计数器的文件描述符，用于进程间事件通知。通过参数解析和错误处理，我们成功实现了该系统调用，并能够根据传入的参数创建相应的 eventfd，从而为进程间通信提供了一种有效的机制。</p>
<p>这次实验为我们提供了一个很好的机会，加深了对操作系统的理解，并提高了我们的系统编程能力。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5Blog-%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5-%E7%BD%97%E5%81%A5%E5%B3%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5Blog-%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5-%E7%BD%97%E5%81%A5%E5%B3%B0/" class="post-title-link" itemprop="url">2024春夏季开源操作系统训练营Blog-第二阶段-罗健峰</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-17 23:46:47" itemprop="dateCreated datePublished" datetime="2024-05-17T23:46:47+00:00">2024-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-11 07:51:25" itemprop="dateModified" datetime="2024-11-11T07:51:25+00:00">2024-11-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/report/" itemprop="url" rel="index"><span itemprop="name">report</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2024春夏季开源操作系统训练营Blog-第二阶段-罗健峰"><a href="#2024春夏季开源操作系统训练营Blog-第二阶段-罗健峰" class="headerlink" title="2024春夏季开源操作系统训练营Blog-第二阶段-罗健峰"></a>2024春夏季开源操作系统训练营Blog-第二阶段-罗健峰</h1><h2 id="开头"><a href="#开头" class="headerlink" title="开头"></a>开头</h2><p>对于操作系统这门课上，我是比较薄弱的，就目前在写此总结之余，想起来我还是感觉有些吃力，主要的困点和难点在于我在训练营开始学习之前，学习过操作系统但没有这么深入，仅仅停留在简单的进程、线程和一些简单的调度算法，再一个就是我本身的学习和工作都在应用层，CPU指令集、硬件这一块的理解还是不太深入。但总体来讲我还是比较高兴自己能够坚持下来，回首一看，真是不容易，要补的，要学习的还是非常多。我接下来的打算就是反复细致的再回首，好好吃透rcore，在rcore的基础上想实现一些其他的功能，同时迎接第三阶段的学习。</p>
<p>好了，回归正题，我将以各章所遇到的情况分别总结。</p>
<h2 id="第一章"><a href="#第一章" class="headerlink" title="第一章"></a>第一章</h2><p>第一章的代码树比较简单，主要的内容还是让同学们对操作系统有个大致的启动流程。</p>
<ol>
<li>用<code>qemu</code>来模拟基于<code>risc-v</code>指令集的裸机环境。</li>
<li>将<code>qemu</code>的启动地址设置为rustsbi的地址来引导操作系统的入口函数。同时接触到第一次risc-v汇编语言（entry.asm）。</li>
<li>剥离rust基于特定操作系统的用户标准库。</li>
<li>一些OS的基础库（日志、标准输出、sbi、异常处理、内存布局等等）</li>
</ol>
<p>最后运行裸机环境下的os，输出hello world!,此时的os其实不叫os，可能更像是一个库函数。整个计算机的资源都为它一个程序服务。</p>
<p>第一章还是比较简单，没有遇到太大的问题。</p>
<h2 id="第二章-批处理系统"><a href="#第二章-批处理系统" class="headerlink" title="第二章 批处理系统"></a>第二章 批处理系统</h2><p>第二章的主要内容是risc-v指令集的特权级机制。</p>
<p>由于第一章是运行单个程序、更多的是一个函数库的使用。</p>
<p>第二章在基于特权级机制下，我们将多个程序一起打包在一起，在第一个程序执行完后，就会自动的执行下一个程序，<strong>但要注意的是目前执行的程序都不是全部加载到内存里面的，而是在我们约定好的一个具体的物理地址上</strong>，同时特权级机制保障了程序在运行过程中发生错误时，能够触发异常陷入trap进而从用户态转入到内核态去执行和处理异常，进而保证程序错误不会影响接下来的程序运行。</p>
<p>第二章也比较好理解和简单。</p>
<h2 id="第三章-多道程序与分时任务"><a href="#第三章-多道程序与分时任务" class="headerlink" title="第三章 多道程序与分时任务"></a>第三章 多道程序与分时任务</h2><p>第三章在第二章的基础上，从一个一个加载到固定内存地址去执行，到一次性全部加载到内存里执行，减少任务切换的开销，同时可以并发的执行多个用户程序。</p>
<p>最重要的是实现了yield系统调用来主动放弃处理器的执行权，</p>
<p>进而可以让OS来调度一个任务的执行还是强制打断，其中打断需要保存上下文，在下一个时间片时恢复原先程序的上下文状态，采用时间片轮转算法调度用户程序。</p>
<p>同时引申出了其他的调度算法，也是一个比较值得研究的地方。后面有时间了还是想看看windows和linux内核的调度算法，学习学习。</p>
<h2 id="第四章-地址空间"><a href="#第四章-地址空间" class="headerlink" title="第四章 地址空间"></a>第四章 地址空间</h2><p>由于前面的OS，应用程序都是运行在真实的物理内存上的，任务多了，给应用程序员带来了很大的麻烦，他们在写程序的时候得仔细考虑一下应用该在哪个内存区间内执行，不会影响其他程序和自身程序的运行，再一个就是操作系统有义务来管理程序的运行，和减少上层应用程序员的心智负担，让他们不需要考虑程序的具体运行和内存的分布。</p>
<p>所以说我们引入了一个新的抽象层，地址空间。</p>
<p>实现地址空间不单单是os来做的，在risc-v指令集的硬件设计上也有实现，主要的参与者是MMU，其中<code>stap</code>寄存器是来开启risc-v指令集的分页机制的</p>
<p>通过设置<code>stap</code>寄存器来开启，目前OS实现的是SV39分页机制。</p>
<p>基于SV39的分页机制，就可以通过 va -&gt; vpn -&gt; ppn -&gt; pa的关系，从虚拟地址转换到物理地址。</p>
<p>其中os维护了这一映射关系，在代码中的体现是<code>PageTable</code>和相关的工具函数。</p>
<blockquote>
<p>注：<br>运行时，内核要运行在内核的自己的地址空间中，同时它还得需要知道具体的物理内存地址，能读取到应用中的数据。我们引入了跳板机制。</p>
</blockquote>
<p>在每一个程序的最高位地址空间中都注入了跳板，以达到操作系统能读取到应用程序的方便，同时补上risc-v寄存器不够存储上下文的情况。</p>
<h2 id="第五章-进程及进程管理"><a href="#第五章-进程及进程管理" class="headerlink" title="第五章 进程及进程管理"></a>第五章 进程及进程管理</h2><p>在第四章地址空间的基础上，我们把前面所谓的任务，升级为进程，其实本质上来讲就是进程。</p>
<p>我们对任务建立新的抽象：进程</p>
<p>引入进程相关的状态。</p>
<p>我们引入了进程相关的内容，整个项目的进程管理是一颗树，同时实现了一些进程相关的系统调用，<code>fork</code>、<code>exec</code>、<code>waitpid</code> 等。</p>
<p>这颗进程管理树，是通过用户初始化进程展开的，这个进程是被内置在我们操作系统中的，其他的进程皆可以通过<code>fork + exec</code> 创建和执行。</p>
<p>同时实现了新的stride调度算法，同时设置相关的进程优先级。</p>
<p>这一章的内容是比较多的，当时我在学习的时候还是废了老大劲了，目前准备在写完总结之后再仔细研究研究，准备换个新的进程调度算法。</p>
<h2 id="第六章-文件系统与I-O重定向"><a href="#第六章-文件系统与I-O重定向" class="headerlink" title="第六章 文件系统与I/O重定向"></a>第六章 文件系统与I/O重定向</h2><p>这一章，我还没太细致的研究，但总体来讲主要是要明白文件系统的管理方式，其中目录和文件的区分。</p>
<p>easy-fs的磁盘布局</p>
<p>sb | bitmap | diskInode | 数据块位图 | 数据块区域 DataBlock</p>
<h2 id="第七章-进程间通讯"><a href="#第七章-进程间通讯" class="headerlink" title="第七章 进程间通讯"></a>第七章 进程间通讯</h2><ol>
<li>主要是进程与管道。</li>
<li>一些进程之间的通讯方式，通过管道</li>
</ol>
<p>后面的想法是通过消息队列来实现进程之间的通讯，目前有一些语言的同步方式就是使用的消息队列。</p>
<h2 id="第八章-并发"><a href="#第八章-并发" class="headerlink" title="第八章 并发"></a>第八章 并发</h2><p>没有和前面的系统前向兼容，主要是为os实现锁机制和检测死锁，以及如何恢复，解开锁。</p>
<p>一些死锁算法。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>还是非常感谢开源操作系统社区这个平台，文档V3和2024s写的非常好和细致，在整个阅读下来非常舒服，同时也学到了很多的新东西。RAII的设计模式有了更加深刻的体会，也学会了qemu、gdb、make等工具的使用，加深了对rust语言的学习。</p>
<p>最后，非常感谢！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/17/2024%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-by-xhyf77/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/17/2024%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-by-xhyf77/" class="post-title-link" itemprop="url">2024春第二阶段总结报告 by:xhyf77</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-17 15:17:48" itemprop="dateCreated datePublished" datetime="2024-05-17T15:17:48+00:00">2024-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-11 07:51:25" itemprop="dateModified" datetime="2024-11-11T07:51:25+00:00">2024-11-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/report/" itemprop="url" rel="index"><span itemprop="name">report</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="第二阶段总结"><a href="#第二阶段总结" class="headerlink" title="第二阶段总结"></a>第二阶段总结</h3><p>在第二阶段的学习过程中，是我对进程的概念有了更加深刻的认识，之前对进程和线程的认知还是比较模糊，且之前没有看过多线程的源码，一直不太能理解进程和线程的本质区别，而这次经过rCore的学习，让我从源码级别真正触碰到了进程和线程，让我对这个概念的理解更加深刻。同时在学习过程中也加强了我的调试能力，特别是对gdb的使用，还记得做lab4的时候因为一个bug调试了几天，虽然最后也没能调试出来换了别的方案实现，但是还是让我受益匪浅。同时我对RAII的这种设计模式也有了更加深刻的体会，我以前也用c写过x86的内核，但这次用rust来写内核给我的体验是完全不一样的，这种RAII的设计模式让我感觉我在用写开发项目的方式来写操作系统，比用c写要方便许多。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/17/2024%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-lovelyTao/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/17/2024%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-lovelyTao/" class="post-title-link" itemprop="url">2024春季开源操作系统训练营第二阶段总结-lovelyTao</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-17 12:36:57" itemprop="dateCreated datePublished" datetime="2024-05-17T12:36:57+00:00">2024-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-11 07:51:25" itemprop="dateModified" datetime="2024-11-11T07:51:25+00:00">2024-11-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/reports/" itemprop="url" rel="index"><span itemprop="name">reports</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>5.1放假结束后才有时间开始做，两个礼拜的时间每天只要没有事情，就是肝lab，虽然学习过程感觉很艰辛，但是每次看到lab测试全部通过就会感到很兴奋。</p>
<p>这是第一次学习rust并用rust实现需求，很多写法思路都是照着rcore代码实现的，感觉从里面学到了很多，对RAII的思想了解的更加深刻了，体会到了它的魅力</p>
<p>在做lab的过程中，逐渐学习如何对代码结构进行优化，虽然现在代码写的还是一坨，但是有努力在学习好的想法。希望能在未来的学习中进一步规范自己的代码规范，进一步学习如何写出优雅的代码。</p>
<p>lab5是最让人感觉没头绪的实验，但是我选择了先实现能实现的，在实践过程中我发现这样的方法能让我更容易克服困难，但是在完成后我发现问题，这样往往会导致一些结构上的设计不够完美。所以最好的选择估计是完成后，在对整体进行优化，重构所写的功能。</p>
<p>在参加项目之前，我还没有感受到阅读源码的魅力，在学习过程中，在读代码的过程中发现能让我对知识有更好的理解，有时候光看手册，会觉得非常的枯燥，很那理解，当结合编译器对代码一个个进行跳转查看的时候，我发现理解起来好了很多。阅读代码也能让我学习更多好的代码桂发，写出一些比较好的代码。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/17/2024S%20%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E6%80%BB%E7%BB%93-%E9%99%88%E5%98%89%E9%91%AB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/17/2024S%20%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E6%80%BB%E7%BB%93-%E9%99%88%E5%98%89%E9%91%AB/" class="post-title-link" itemprop="url">2024S 开源操作系统训练营总结-陈嘉鑫</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-17 11:56:58" itemprop="dateCreated datePublished" datetime="2024-05-17T11:56:58+00:00">2024-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-11 07:51:25" itemprop="dateModified" datetime="2024-11-11T07:51:25+00:00">2024-11-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5/" itemprop="url" rel="index"><span itemprop="name">2024春夏季开源操作系统训练营</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="一阶段"><a href="#一阶段" class="headerlink" title="一阶段"></a>一阶段</h1><h2 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h2><p>之前几次训练营我没赶上, 这次过年后就关注了.</p>
<h2 id="Rust"><a href="#Rust" class="headerlink" title="Rust"></a>Rust</h2><p>目前实习工作是用 rust 的算懂一点, 不过马上离职了.<br>一阶段的写链表还是有意思的哈哈哈</p>
<h1 id="二阶段"><a href="#二阶段" class="headerlink" title="二阶段"></a>二阶段</h1><h2 id="收获"><a href="#收获" class="headerlink" title="收获"></a>收获</h2><p>老哥们在二阶段刚刚开始的时候通宵冲榜太猛了.<br>个人感觉 lab4 的复杂度是最高的, 主要是在 block cache 这一块, 如果是萌新确实理解起来难度比较大.<br>20 年的时候我做过 xv6-riscv 的实验, COW, lazy fork 之类的实验都被放在了选做题部分, 但是选做我都是不做的.<br>rCore对我帮助最大的是从零开始怎么写一个 kernel, 而 xv6 是在一个 kernel 上加 feature .<br>希望之后 rCore 能够加入其他的架构, 我感觉 riscv 是可以自学的, 比如从 61c 开始, 但是x86真得有老师指导, 实模式,保护模式,长模式, apic, aipc, multiboot, 人已经晕了.<br>还希望有个微内核版本.  </p>
<p>感谢清华大学, 感谢 rCore 社区</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/" class="post-title-link" itemprop="url">2024春夏季OS训练营:如何快速搭建基于docker和vscode的开发和调试环境-xuejianxinokok.md</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-17 09:23:01" itemprop="dateCreated datePublished" datetime="2024-05-17T09:23:01+00:00">2024-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-11 07:51:25" itemprop="dateModified" datetime="2024-11-11T07:51:25+00:00">2024-11-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一阶段学习参考</p>
<ul>
<li><p><a href="https://juejin.cn/post/7358742048134365221" target="_blank" rel="noopener">转:Learn Rust the Dangerous Way-系列文章翻译-总述 - 掘金</a>，这系列文章总结了rust改写c语言 ，非常经典</p>
</li>
<li><p><a href="https://juejin.cn/post/7359110982227640374" target="_blank" rel="noopener">*如何在rust 中实现 带有循环引用的数据结构 - 掘金</a></p>
</li>
</ul>
<hr>
<p>在学习os开发的时候如何使我们能够愉快的开始学习，而不在配置环境折腾的时间太长，以下是我的实践。</p>
<p>我的系统是windows11,上边安装了dockerdesktop.</p>
<h2 id="1-docker-容器"><a href="#1-docker-容器" class="headerlink" title="1. docker 容器"></a>1. docker 容器</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 检出源码</span></span><br><span class="line"></span><br><span class="line">git clone git://github.com/rcore-os/rCore-Tutorial-v3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到源码目录，我把源码检出到 本机以下目录</span></span><br><span class="line"></span><br><span class="line">cd  D:\work20220906\gitee\rusttest\rCore-Tutorial-v3</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 制作 docker 镜像</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这里我们把镜像的名称设置为rcore</span></span><br><span class="line">docker build -t rcore  --target build .</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 运行docker dev container</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 为了能够在容器内看到源码，需要把包含源码的目录 隐射到容器内部</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我为了方便 把源码的上层目录隐射到了容器内部 /mnt</span></span><br><span class="line">docker run --name os1 --hostname os1  -v D:/work20220906/gitee/rusttest/:/mnt -w /mnt  -d rcore  sleep infinity </span><br><span class="line"><span class="meta">#</span><span class="bash"> docker  rm -f os1 </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在cmd 中， 进入容器ssh </span></span><br><span class="line">docker exec -it os1 /bin/bash </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试运行</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到目录</span></span><br><span class="line">cd /mnt/rCore-Tutorial-v3/os</span><br><span class="line">运行</span><br><span class="line">make run</span><br></pre></td></tr></table></figure>

<p>docker 镜像</p>
<img src="/blog/.io//2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/2024-05-17-09-40-49-image.png" class title="2024-05-17-09-40-49-image">

<p>开发容器</p>
<img src="/blog/.io//2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/2024-05-17-09-41-14-image.png" class title="2024-05-17-09-41-14-image">

<h2 id="2-dev-container-开发环境"><a href="#2-dev-container-开发环境" class="headerlink" title="2. dev container 开发环境"></a>2. dev container 开发环境</h2><h3 id="2-1-安装vscode-及其插件"><a href="#2-1-安装vscode-及其插件" class="headerlink" title="2.1 安装vscode 及其插件"></a>2.1 安装vscode 及其插件</h3><p>为了支持docker dev container 需要安装以下插件</p>
<img src="/blog/.io//2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/2024-05-17-09-42-12-image.png" class title="2024-05-17-09-42-12-image">

<p>点击以下红色标识位置连接到dev container</p>
<img src="/blog/.io//2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/2024-05-17-09-46-03-image.png" class title="2024-05-17-09-46-03-image.png">

<p>然后打开/mnt/ 目录下的项目文件夹</p>
<img src="/blog/.io//2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/2024-05-17-09-47-48-image.png" class title="2024-05-17-09-47-48-image.png">

<h2 id="2-2-安装调试插件"><a href="#2-2-安装调试插件" class="headerlink" title="2.2 安装调试插件"></a>2.2 安装调试插件</h2><img src="/blog/.io//2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/2024-05-17-09-49-01-image.png" class title="2024-05-17-09-49-01-image.png">

<h2 id="3-在vscode-中支持远程调试"><a href="#3-在vscode-中支持远程调试" class="headerlink" title="3. 在vscode 中支持远程调试"></a>3. 在vscode 中支持远程调试</h2><h3 id="3-1-在容器os1-内编译-gdb"><a href="#3-1-在容器os1-内编译-gdb" class="headerlink" title="3.1 在容器os1 内编译 gdb"></a>3.1 在容器os1 内编译 gdb</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">```shell</span><br><span class="line"><span class="meta">#</span><span class="bash">1. 进入docker </span></span><br><span class="line">docker exec -it os1 /bin/bash</span><br><span class="line"><span class="meta">#</span><span class="bash">2. 安装终端复用工具</span></span><br><span class="line">apt install tmux</span><br><span class="line">apt-get install libncurses5-dev texinfo libreadline-dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 configure  发现少了2个库，补上</span></span><br><span class="line">apt-get install libgmp-dev libmpfr-dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> 缺少python-dev，没有也可</span></span><br><span class="line">apt install python3.8-dev</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 好像docker 环境已经预装了python3.8</span></span><br><span class="line"><span class="meta">#</span><span class="bash">apt-get install python3</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="built_in">which</span> python3 </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ll $(<span class="built_in">which</span> python3)  </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 建立符号连接 到/usr/bin/python</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ln -s  /usr/bin/python3.8*  /usr/bin/python</span></span><br><span class="line"><span class="meta">#</span><span class="bash">root@os1:/usr/bin<span class="comment"># which python</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">whereis python3</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">python3 --version</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Python 3.8.10</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">4. 下载gdb</span></span><br><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/gnu/gdb/gdb-14.2.tar.xz</span><br><span class="line"><span class="meta">#</span><span class="bash">解压</span></span><br><span class="line">tar -xvf gdb-14.2.tar.xz</span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入目录</span></span><br><span class="line">cd gdb-</span><br><span class="line">14.2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看当前目录 <span class="built_in">pwd</span></span></span><br><span class="line">/mnt/gdb-14.2</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建编译目录</span></span><br><span class="line">mkdir build-riscv64</span><br><span class="line"></span><br><span class="line">cd build-riscv64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">5. 配置编译选项，可以不配置with-python</span></span><br><span class="line">../configure --prefix=/mnt/gdb-14.2/build-riscv64 --with-python=/usr/bin/python3 --target=riscv64-unknown-elf --enable-tui=yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6.编译</span></span><br><span class="line">make -j$(nproc)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 7.安装</span></span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 8. 编译好的 GDB 存放在 build-riscv64/bin/ 目录下，你可以只保留这个目录，然后添加这个目录到环境变量。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 确认 GDB 可以运行</span></span><br><span class="line">./bin/riscv64-unknown-elf-gdb --version</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@os1:/mnt/gdb-14.2/build-riscv64# ./bin/riscv64-unknown-elf-gdb --version</span><br><span class="line">GNU gdb (GDB) 14.2</span><br><span class="line">Copyright (C) 2023 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line">root@os1:/mnt/gdb-14.2/build-riscv64# ll ./bin/</span><br><span class="line">total 238428</span><br><span class="line">drwxr-xr-x 1 root root      4096 May 13 03:10 ./</span><br><span class="line">drwxr-xr-x 1 root root      4096 May 13 03:10 ../</span><br><span class="line">-rwxr-xr-x 1 root root 232530576 May 13 03:10 riscv64-unknown-elf-gdb*</span><br><span class="line">-rwxr-xr-x 1 root root      4627 May 13 03:10 riscv64-unknown-elf-gdb-add-index*</span><br><span class="line">-rwxr-xr-x 1 root root  11605272 May 13 03:10 riscv64-unknown-elf-run*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 我们直接拷贝到/usr/<span class="built_in">local</span>/bin 目录，这样直接可以全局使用</span></span><br><span class="line">ll /usr/local/bin</span><br><span class="line"></span><br><span class="line">cp /mnt/gdb-14.2/build-riscv64/bin/*  /usr/local/bin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 9. 安装 gdb-dashboard：仅仅是下载一个 python 文件到 ~/.gdbinit 来做 gdb 的启动拓展</span></span><br><span class="line">wget -P ~ https://github.com/cyrus-and/gdb-dashboard/raw/master/.gdbinit</span><br><span class="line"><span class="meta">#</span><span class="bash"> 以下是 gdbinit 文件的存放目录</span></span><br><span class="line">root@os1:~# pwd</span><br><span class="line">/root</span><br><span class="line">root@os1:~# ll -la</span><br><span class="line">-rw-r--r-- 1 root root 93928 May 13 03:15 .gdbinit</span><br></pre></td></tr></table></figure>

<h3 id="3-2-使编译的os文件支持调试信息"><a href="#3-2-使编译的os文件支持调试信息" class="headerlink" title="3.2 使编译的os文件支持调试信息"></a>3.2 使编译的os文件支持调试信息</h3><p><strong>以rcore  ch3 为例</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1. os/Makefile 文件中 修改和添加以下内容</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MODE := release  保证是debug编译 会保留符号信息</span></span><br><span class="line">MODE := debug</span><br><span class="line"><span class="meta">#</span><span class="bash"> 包装gdb 命令否则rustc源码无法对应</span></span><br><span class="line">GDB_PATH := riscv64-unknown-elf-gdb</span><br><span class="line">gdb := RUST_GDB=$(GDB_PATH) rust-gdb</span><br><span class="line"></span><br><span class="line">debug: build</span><br><span class="line">    @tmux new-session -d \</span><br><span class="line">        "qemu-system-riscv64 -machine virt -nographic -bios $(BOOTLOADER) -device loader,file=$(KERNEL_BIN),addr=$(KERNEL_ENTRY_PA) -s -S" &amp;&amp; \</span><br><span class="line">        tmux split-window -h "$(gdb) -ex 'file $(KERNEL_ELF)' -ex 'set arch riscv:rv64' -ex 'target remote localhost:1234'" &amp;&amp; \</span><br><span class="line">        tmux -2 attach-session -d</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2. user/Makefile</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MODE := release  保证编译debug</span></span><br><span class="line">MODE := debug</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">3. user/build.py</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">mode = os.getenv(<span class="string">"MODE"</span>, default = <span class="string">"release"</span>)</span></span><br><span class="line">mode = os.getenv("MODE", default = "debug")</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4.user/src/linker.ld 文件中</span></span><br><span class="line">/DISCARD/ : &#123;</span><br><span class="line">        *(.eh_frame)</span><br><span class="line">      /*  *(.debug*) */  注释掉这行，不删除调试信息</span><br></pre></td></tr></table></figure>

<p>用以下命令确定os文件支持调试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">root@os1:/mnt/2024s-rcore-xuejianxinokok/os/target/riscv64gc-unknown-none-elf/debug# file os</span><br><span class="line">os: ELF 64-bit LSB executable, UCB RISC-V, version 1 (SYSV), </span><br><span class="line">statically linked, </span><br><span class="line"></span><br><span class="line">with debug_info, not stripped   &lt;&lt;&lt;&lt;&lt;&lt;&lt; 注意是这行</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者直接读取section 信息，发现有debug_info  这些section</span></span><br><span class="line">root@os1:/mnt/2024s-rcore-xuejianxinokok/os/target/riscv64gc-unknown-none-elf/debug# readelf -SW os</span><br><span class="line">There are 18 section headers, starting at offset 0x2952a8:</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type            Address          Off    Size   ES Flg Lk Inf Al</span><br><span class="line">  [ 0]                   NULL            0000000000000000 000000 000000 00      0   0  0</span><br><span class="line">  [ 1] .text             PROGBITS        0000000080200000 001000 00a340 00  AX  0   0  4</span><br><span class="line">  [ 2] .rodata           PROGBITS        000000008020b000 00c000 0334ab 00  AM  0   0 4096</span><br><span class="line">  [ 3] .data             PROGBITS        000000008023f000 040000 028920 00  WA  0   0  8</span><br><span class="line">  [ 4] .bss              NOBITS          0000000080268000 068920 038660 00  WA  0   0  8</span><br><span class="line">  [ 5] .debug_abbrev     PROGBITS        0000000000000000 068920 006a82 00      0   0  1</span><br><span class="line">  [ 6] .debug_info       PROGBITS        0000000000000000 06f3a2 073718 00      0   0  1</span><br><span class="line">  [ 7] .debug_aranges    PROGBITS        0000000000000000 0e2aba 0061b0 00      0   0  1</span><br><span class="line">  [ 8] .debug_str        PROGBITS        0000000000000000 0e8c6a 08d4ab 01  MS  0   0  1</span><br><span class="line">  [ 9] .comment          PROGBITS        0000000000000000 176115 000048 01  MS  0   0  1</span><br><span class="line">  [10] .riscv.attributes RISCV_ATTRIBUTES 0000000000000000 17615d 00003e 00      0   0  1</span><br><span class="line">  [11] .debug_frame      PROGBITS        0000000000000000 1761a0 007f08 00      0   0  8</span><br><span class="line">  [12] .debug_line       PROGBITS        0000000000000000 17e0a8 040627 00      0   0  1</span><br><span class="line">  [13] .debug_ranges     PROGBITS        0000000000000000 1be6cf 033b00 00      0   0  1</span><br><span class="line">  [14] .debug_loc        PROGBITS        0000000000000000 1f21cf 000b72 00      0   0  1</span><br><span class="line">  [15] .symtab           SYMTAB          0000000000000000 1f2d48 096048 18     17 25465  8</span><br><span class="line">  [16] .shstrtab         STRTAB          0000000000000000 288d90 0000b5 00      0   0  1</span><br><span class="line">  [17] .strtab           STRTAB          0000000000000000 288e45 00c462 00      0   0  1</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</span><br><span class="line">  L (link order), O (extra OS processing required), G (group), T (TLS),</span><br><span class="line">  C (compressed), x (unknown), o (OS specific), E (exclude),</span><br><span class="line">  p (processor specific)</span><br></pre></td></tr></table></figure>

<p>这时我们就可以在 容器内的命令行进行调试了，但这样还是不太方便</p>
<p>进入gbd 后</p>
<p><strong>先回车后</strong> ,然后再输入 <code>b rust_main</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b rust_main </span><br><span class="line">Breakpoint 1 at 0x8020618a: file src&#x2F;main.rs, line 98.</span><br></pre></td></tr></table></figure>

<p>再输入 c</p>
<img src="/blog/.io//2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/2024-05-14-14-13-18-image.png" class title="2024-05-14-14-13-18-image.png">

<img src="/blog/.io//2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/2024-05-14-14-20-57-image.png" class title="2024-05-14-14-20-57-image.png">

<h3 id="3-3-配置vscode-调试"><a href="#3-3-配置vscode-调试" class="headerlink" title="3.3 配置vscode 调试"></a>3.3 配置vscode 调试</h3><p>虽然我们就可以在命令行进行调试了，但这样还是不太方便，我们接着配置vscode中的调试</p>
<p>按F5 启动调试添加 .vscode/launch.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"0.2.0"</span>,</span><br><span class="line">    <span class="attr">"configurations"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"gdb Remote Launch"</span>,</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"cppdbg"</span>,</span><br><span class="line">            <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">            <span class="attr">"program"</span>: <span class="string">"$&#123;workspaceRoot&#125;/os/target/riscv64gc-unknown-none-elf/debug/os"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [],</span><br><span class="line">            <span class="attr">"stopAtEntry"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"environment"</span>: [],</span><br><span class="line">            <span class="attr">"externalConsole"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"MIMode"</span>: <span class="string">"gdb"</span>,</span><br><span class="line">            <span class="attr">"miDebuggerPath"</span>: <span class="string">"riscv64-unknown-elf-gdb"</span>,</span><br><span class="line">            <span class="attr">"miDebuggerServerAddress"</span>: <span class="string">"localhost:1234"</span>,</span><br><span class="line">            <span class="attr">"miDebuggerArgs"</span>: <span class="string">"gdb"</span>,</span><br><span class="line"></span><br><span class="line">            <span class="attr">"setupCommands"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">"text"</span>: <span class="string">"set arch riscv:rv64"</span>,</span><br><span class="line">                  <span class="attr">"ignoreFailures"</span>: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"description"</span>: <span class="string">"Enable pretty-printing for gdb"</span>,</span><br><span class="line">                    <span class="attr">"text"</span>: <span class="string">"-enable-pretty-printing"</span>,</span><br><span class="line">                    <span class="attr">"ignoreFailures"</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"cwd"</span>: <span class="string">"$&#123;workspaceFolder&#125;"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在另一个终端窗口启动 make gdbserver</strong></p>
<p>在vscode 启动调试</p>
<p><img src="/blog/.io//2024-05-15-13-49-42-image.png" alt></p>
<img src="/blog/.io//2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/2024-05-15-13-49-42-image.png" class title="2024-05-15-13-49-42-image.png">

<img src="/blog/.io//2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/2024-05-15-13-59-17-image.png" class title="2024-05-15-13-59-17-image.png">

<img src="/blog/.io//2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/2024-05-15-14-00-13-image.png" class title="2024-05-15-14-00-13-image.png">

<img src="/blog/.io//2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3OS%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%A6%82%E4%BD%95%E5%BF%AB%E9%80%9F%E6%90%AD%E5%BB%BA%E5%9F%BA%E4%BA%8Edocker%E5%92%8Cvscode%E7%9A%84%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83-xuejianxinokok-md/2024-05-15-14-02-58-image.png" class title="2024-05-15-14-02-58-image">

<p>为了每次按F5 时能够自动打开gbdserver</p>
<p>需要在 .vscode/launch.json配置一个preLaunchTask</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"0.2.0"</span>,</span><br><span class="line">    <span class="attr">"configurations"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"gdb Remote Launch"</span>,</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"cppdbg"</span>,</span><br><span class="line">            <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">            <span class="attr">"program"</span>: <span class="string">"$&#123;workspaceRoot&#125;/os/target/riscv64gc-unknown-none-elf/debug/os"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [],</span><br><span class="line">            <span class="comment">// 在入口处停止</span></span><br><span class="line">            <span class="attr">"stopAtEntry"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="attr">"environment"</span>: [],</span><br><span class="line">            <span class="attr">"externalConsole"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="comment">// 调试会话开始前执行的任务，一般为编译程序。与tasks.json的label相对应</span></span><br><span class="line">            <span class="comment">// 参考 https://blog.csdn.net/BlizCp/article/details/111054747</span></span><br><span class="line">            <span class="attr">"preLaunchTask"</span>: <span class="string">"startGdbserverTask"</span>,</span><br><span class="line">            <span class="attr">"MIMode"</span>: <span class="string">"gdb"</span>,</span><br><span class="line">            <span class="comment">//调试器路径，Windows下后缀不能省略，Linux下则去掉</span></span><br><span class="line">            <span class="attr">"miDebuggerPath"</span>: <span class="string">"riscv64-unknown-elf-gdb"</span>,</span><br><span class="line">            <span class="attr">"miDebuggerServerAddress"</span>: <span class="string">"localhost:1234"</span>,</span><br><span class="line">            <span class="attr">"miDebuggerArgs"</span>: <span class="string">"gdb"</span>,</span><br><span class="line"></span><br><span class="line">            <span class="attr">"setupCommands"</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">"text"</span>: <span class="string">"set arch riscv:rv64"</span>,</span><br><span class="line">                  <span class="attr">"ignoreFailures"</span>: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="attr">"description"</span>: <span class="string">"Enable pretty-printing for gdb"</span>,</span><br><span class="line">                    <span class="attr">"text"</span>: <span class="string">"-enable-pretty-printing"</span>,</span><br><span class="line">                    <span class="attr">"ignoreFailures"</span>: <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"cwd"</span>: <span class="string">"$&#123;workspaceFolder&#125;"</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在.vscode/tasks.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"version"</span>: <span class="string">"2.0.0"</span>,</span><br><span class="line">    <span class="attr">"tasks"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"type"</span>: <span class="string">"shell"</span>,</span><br><span class="line">            <span class="attr">"label"</span>: <span class="string">"startGdbserverTask"</span>,</span><br><span class="line">            <span class="attr">"command"</span>: <span class="string">"nohup"</span>,</span><br><span class="line">            <span class="attr">"args"</span>: [</span><br><span class="line">                <span class="string">"make"</span>,</span><br><span class="line">                <span class="string">"gdbserver"</span>,</span><br><span class="line">                <span class="string">"-w"</span>,</span><br><span class="line"></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"options"</span>: &#123;</span><br><span class="line">                <span class="attr">"cwd"</span>: <span class="string">"$&#123;workspaceRoot&#125;/os"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"hide"</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了能使 gdbserver在后台运行，os/Makefile,在命令结尾-s -S 后边添加了 <code>&amp;</code> ,否则阻塞client启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdbserver: build</span><br><span class="line">    @qemu-system-riscv64 -machine virt -nographic -bios $(BOOTLOADER) -device loader,file=$(KERNEL_BIN),addr=$(KERNEL_ENTRY_PA) -s -S &amp;</span><br></pre></td></tr></table></figure>

<p>有时候gdbserver 没有被杀死导致启动不了,需要找到进程然后手动kill</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@os1:/mnt/2024s-rcore-xuejianxinokok/os# lsof -i:1234</span><br><span class="line">COMMAND    PID USER   FD   TYPE  DEVICE SIZE/OFF NODE NAME</span><br><span class="line">qemu-syst 5049 root    9u  IPv4 8134403      0t0  TCP *:1234 (LISTEN)</span><br><span class="line">qemu-syst 5049 root   10u  IPv6 8134404      0t0  TCP *:1234 (LISTEN)</span><br></pre></td></tr></table></figure>

<p>这样就可以愉快的调试了。</p>
<p>路漫漫…</p>
<p>感谢训练营的老师们！！！</p>
<hr>
<h2 id="4-参考文档："><a href="#4-参考文档：" class="headerlink" title="4.参考文档："></a>4.参考文档：</h2><ul>
<li><p><a href="https://zjp-cn.github.io/posts/rcore-gdb/" target="_blank" rel="noopener">【笔记】rCore (RISC-V)：GDB 使用记录 | 苦瓜小仔</a></p>
</li>
<li><p><a href="https://rcore-os.cn/rCore-Tutorial-deploy/docs/pre-lab/gdb.html" target="_blank" rel="noopener">rcore GDB 调试方法* · GitBook</a></p>
</li>
<li><p><a href="https://blog.csdn.net/shipeng1022/article/details/134397319" target="_blank" rel="noopener">主要参考:文档vscode + gdb +gdbserver 远程调试Pg源码_vscode gdbserver-CSDN博客</a></p>
</li>
<li><p><a href="https://blog.csdn.net/BlizCp/article/details/111054747" target="_blank" rel="noopener">VSCode配置luanch和task_配置 prelaunchtask 阻塞-CSDN博客</a></p>
</li>
<li><p><a href="https://rcore-os.cn/rCore-Tutorial-Book-v3/appendix-b/index.html" target="_blank" rel="noopener">附录 B：常见工具的使用方法 - rCore-Tutorial-Book-v3 3.6.0-alpha.1 文档</a></p>
</li>
<li><p><a href="https://blog.csdn.net/u014552102/article/details/122793256" target="_blank" rel="noopener">VsCode + gdb + gdbserver远程调试C++程序_vscode gdbserver-CSDN博客</a></p>
</li>
<li><p><a href="https://code.visualstudio.com/docs/editor/debugging" target="_blank" rel="noopener">Debugging in Visual Studio Code</a></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%83%91%E6%98%B1%E5%8F%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/17/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E9%83%91%E6%98%B1%E5%8F%AF/" class="post-title-link" itemprop="url">2024春夏季开源操作系统训练营第二阶段总结报告-郑昱可</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-17 08:27:17" itemprop="dateCreated datePublished" datetime="2024-05-17T08:27:17+00:00">2024-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-11 07:51:25" itemprop="dateModified" datetime="2024-11-11T07:51:25+00:00">2024-11-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/report/" itemprop="url" rel="index"><span itemprop="name">report</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="本阶段的收获"><a href="#本阶段的收获" class="headerlink" title="本阶段的收获"></a>本阶段的收获</h1><p>经过半月多的赶ddl（，加上老师群友们的无私帮助，我成功的完成了第二阶段的任务。</p>
<p>不仅对Rust的掌握程度更深了，并且对操作系统中很多概念有了实际上的理解。</p>
<p>包括且不限于：</p>
<ul>
<li>特权态的切换</li>
<li>地址表，页表的管理</li>
<li>进程和线程的区别</li>
<li>执行流切换和恢复</li>
<li>线程调度</li>
</ul>
<p>同时，这些知识很大程度上帮助我消除了对裸机编程的恐惧。对计算机底层的运行方式有了清楚的认知。</p>
<h2 id="一个尝试-Rust-in-ch32v003"><a href="#一个尝试-Rust-in-ch32v003" class="headerlink" title="一个尝试-Rust in ch32v003"></a>一个尝试-Rust in ch32v003</h2><p>在前几天结束第二阶段的作业后，我是打算了摸几天鱼，正好看到桌边吃灰的ch32v003单片机。</p>
<blockquote>
<p>ch32v003是一块携带了riscv指令集芯片的单片机，我手头上这块，实现了riscv标准中的mai,以及f。<br>美中不足的是，它只有S态和M态，并没有实现U态。</p>
</blockquote>
<p>于是我萌生出想法——为什么不试试将Rust代码运行在这上面呢。</p>
<h3 id="ch32-hal"><a href="#ch32-hal" class="headerlink" title="ch32-hal"></a>ch32-hal</h3><p>Rust在嵌入式方面的库，在2024年的今天已经较为完善了。在createio中查找一番后，我看到了ch32-hal，以及与其配套的qingke-rt</p>
<p>ch32-hal将ch32系列的单片机的外设进行了rust封装，使得在代码中能方便的进行调用和更改</p>
<p>如修改SYSTICK的ctlr位，只需要以下代码</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SYSTICK.ctlr().modify(|w| w.set_ste(<span class="literal">false</span>));</span><br></pre></td></tr></table></figure>

<p>qingke-rt则包含了运行时相关的内容，可以在main函数前添加#[qingke_rt::entry]，使得该函数称为编译后程序的入口函数</p>
<p>并且qingke-rt也可以通过类似的方法定义中断处理函数。类似的工作，我们在rcore实验中是通过内联汇编手动修改相关寄存器实现的。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>以下附上一个点灯代码</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#[qingke_rt::entry]</span></span><br><span class="line"><span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() -&gt; ! &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> config = hal::Config::default();</span><br><span class="line">    config.rcc = hal::rcc::Config::SYSCLK_FREQ_48MHZ_HSE;</span><br><span class="line">    <span class="keyword">let</span> p = hal::init(config);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> delay = Delay;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> led = Output::new(p.PC2, Level::Low, <span class="built_in">Default</span>::default());</span><br><span class="line">    <span class="keyword">loop</span> &#123;</span><br><span class="line">        led.toggle();</span><br><span class="line"></span><br><span class="line">        delay.delay_ms(<span class="number">500</span>);</span><br><span class="line">        <span class="keyword">let</span> val = hal::pac::SYSTICK.cnt().read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="理论和实践"><a href="#理论和实践" class="headerlink" title="理论和实践"></a>理论和实践</h2><p>之前在学习体系结构的知识时，书本上只有几张图来描述代码执行流的切换，于我而言并不直观。甚至很长一段时间我是当做文科的内容来学的。</p>
<p>经过了本次实验后，令我印象最深的是__switch函数，通过寄存器内容的切换，便可切换到另一个执行流上。</p>
<p>而执行流，在某一时刻无非是:</p>
<ul>
<li>pc指针的位置</li>
<li>栈指针的位置</li>
<li>若干存储在当前寄存器中的变量</li>
</ul>
<p>而对执行流，进一步抽象成包含若干线程的进程。</p>
<p>对若干的进程进行管理，并为进程提供服务，就是操作系统。</p>
<h2 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h2><p>在此之前，我对ntfs之类的文件系统没有一点了解。在这次实验中，了解了一个简单文件系统的实现，并且通过easyfs实现了一些功能。</p>
<p>同时，简单了解到了对于硬件驱动的编写，以及将不同的硬件驱动，抽象成相同的软件内模型。在软件内进行多层抽象，每层抽象负责简单的几件事情。</p>
<p>这样能够方便错误判断，多层抽象的思想我最先从网络原理中了解。easyfs的实现方式，进一步的说明多层抽象在计算机软件编写中，可以称得上是最佳实践了。</p>
<h2 id="进程-amp-线程"><a href="#进程-amp-线程" class="headerlink" title="进程&amp;线程"></a>进程&amp;线程</h2><p>不去亲自阅读操作系统源码，是很难对进程和线程有明确的理解的。</p>
<p>甚至很长一段时间，我对进程和线程并没有区分。而在OS内部，进程可以拥有多个线程，线程之间共享内存空间。</p>
<p>对于这点的了解，不仅是系统编程领域，对我普通的软件编程也大有裨益。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/17/2024%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-%E9%99%88%E9%9F%B5%E6%B6%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/17/2024%E6%98%A5%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-%E9%99%88%E9%9F%B5%E6%B6%B5/" class="post-title-link" itemprop="url">2024春季开源操作系统训练营第二阶段总结-陈韵涵</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-17 00:00:00" itemprop="dateCreated datePublished" datetime="2024-05-17T00:00:00+00:00">2024-05-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-11 07:51:25" itemprop="dateModified" datetime="2024-11-11T07:51:25+00:00">2024-11-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/report/" itemprop="url" rel="index"><span itemprop="name">report</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="第1-2章"><a href="#第1-2章" class="headerlink" title="第1~2章"></a>第1~2章</h1><p>总的来说这两张花的时间是比较久的，因为完全没有学过操作系统，对概念上的理解用了一些时间，真的跟着代码学习的时候，不知道这些代码之间的联系，不知道用户程序和操作系统是怎么联系起来的。</p>
<p>因此总结了一个大概流程：</p>
<p>build.py编译user里面的用户应用程序：</p>
<p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fba0aca6b-3b67-48e5-ac4d-8a0498157baa%2Fce4013a7-036b-4f96-ad8a-d1df978627bd%2FUntitled.png?table=block&id=6708e532-2ebf-47da-8e2a-43eae2e27118&spaceId=ba0aca6b-3b67-48e5-ac4d-8a0498157baa&width=2000&userId=4604a8da-3e33-4cbd-b5b3-bda19d665487&cache=v2" alt="img"></p>
<p>启动qemu和rustsbi，编译os</p>
<p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fba0aca6b-3b67-48e5-ac4d-8a0498157baa%2F5a2d1e07-da11-4184-b467-bbd18be7ce30%2FUntitled.png?table=block&id=177a16ce-556f-4b45-9890-5b6edd590b4c&spaceId=ba0aca6b-3b67-48e5-ac4d-8a0498157baa&width=2000&userId=4604a8da-3e33-4cbd-b5b3-bda19d665487&cache=v2" alt="img"></p>
<p><a href="http://xn--build-s06jr40t.rs" target="_blank" rel="noopener">执行build.rs</a>，将bin文件插入到link_app.S，生成link_app.S</p>
<p>链接</p>
<p><a href="http://main.xn--rsbatch-eb1ux83c.rs" target="_blank" rel="noopener">main.rs运行batch.rs</a>，开始批处理</p>
<p>batch.rs首先初始化一个实例：APP_MANAGER: UPSafeCell<AppManager></AppManager></p>
<p>从link_app.S里面找到_num_app符号，找到每个app的地址存进app_start数组，然后将其打印出来</p>
<p>然后依次执行应用程序，其中应用程序出现错误或者开始下一个应用程序时，需要有用户态到内核态的切换。需要用到Trap.S</p>
<p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fba0aca6b-3b67-48e5-ac4d-8a0498157baa%2Fda654f61-99ec-4b02-8e83-a51d7800dbc4%2FUntitled.png?table=block&id=fe934e8e-bbb7-4476-a852-dfa3851f794d&spaceId=ba0aca6b-3b67-48e5-ac4d-8a0498157baa&width=2000&userId=4604a8da-3e33-4cbd-b5b3-bda19d665487&cache=v2" alt="img"></p>
<p>开始批处理</p>
<p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fba0aca6b-3b67-48e5-ac4d-8a0498157baa%2F9eeae072-eabb-4c7a-99ee-ba555b47cf16%2FUntitled.png?table=block&id=c93ad5b8-d780-4e61-b926-2d5981b09740&spaceId=ba0aca6b-3b67-48e5-ac4d-8a0498157baa&width=2000&userId=4604a8da-3e33-4cbd-b5b3-bda19d665487&cache=v2" alt="img"></p>
<p>保存Trap上下文，之后进入trap_handler，正常情况下会返回并继续执行下一个应用程序</p>
<p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fba0aca6b-3b67-48e5-ac4d-8a0498157baa%2F5d217db3-2514-4954-bcef-a322819058d3%2FUntitled.png?table=block&id=a6081a8e-7120-4d1a-993d-ff8b8d9c0398&spaceId=ba0aca6b-3b67-48e5-ac4d-8a0498157baa&width=2000&userId=4604a8da-3e33-4cbd-b5b3-bda19d665487&cache=v2" alt="img"></p>
<p>这个函数不会返回，会一直将加载应用程序并把当前的应用程序的上下文压入内核栈，sret后就会自动执行下一个应用程序，直到完成</p>
<h1 id="第3章"><a href="#第3章" class="headerlink" title="第3章"></a>第3章</h1><p>主要是学习分时操作系统，概念上还是比较好理解的</p>
<h1 id="第4章"><a href="#第4章" class="headerlink" title="第4章"></a>第4章</h1><p>学习了地址空间，一开始对于这几个概念比较混淆：</p>
<ul>
<li>虚拟地址</li>
<li>虚拟页号</li>
<li>物理地址</li>
<li>物理页号</li>
<li>地址空间</li>
</ul>
<p>后来根据这个图搞懂了</p>
<p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fba0aca6b-3b67-48e5-ac4d-8a0498157baa%2F44bcf144-9c5b-4ba6-9a4e-d579b27f874c%2FUntitled.png?table=block&id=34b9f1a5-ba7f-47db-aa7e-c3abfd31c7f0&spaceId=ba0aca6b-3b67-48e5-ac4d-8a0498157baa&width=2000&userId=4604a8da-3e33-4cbd-b5b3-bda19d665487&cache=v2" alt="img"></p>
<ul>
<li><p>虚拟地址指的是在地址空间里面，数据的地址</p>
</li>
<li><p>虚拟页号指的是虚拟地址字段里面的一个字段，这个字段可以在物理页表上查到一个物理页号，最终通过多级页表，查找到这个虚拟地址对应的物理地址，从而真正在主存读写数据</p>
</li>
<li><p>每个应用的地址空间可以被分成若干个（虚拟） 页面 (Page) ，而可用的物理内存也同样可以被分成若干个（物理） 页帧 (Frame) ，虚拟页面和物理页帧的大小相同</p>
</li>
<li><p>地址空间：一系列有关联的逻辑段：</p>
<p><strong>地址空间</strong>是一系列有关联的逻辑段，这种关联一般是指这些逻辑段属于一个运行的程序（目前把一个运行的程序称为任务，后续会称为进程）。 用来表明正在运行的应用所在执行环境中的可访问内存空间，在这个内存空间中，包含了<strong>一系列的不一定连续的逻辑段</strong>。 这样我们就有任务的地址空间、内核的地址空间等说法了</p>
<p>也就是说，地址空间的逻辑段不一定连续，这就对应了编程题，如果要写的内容太大导致分页，应该直接将内容也分页塞入到其物理地址里面去</p>
</li>
</ul>
<h1 id="第5章"><a href="#第5章" class="headerlink" title="第5章"></a>第5章</h1><p>需要记的就是进程是怎么调度的，switch函数的作用</p>
<p>就是最初，先创建一个idle进程，然后将switch的参数设置为idle进程和第一个程序，使得第一个程序可以执行</p>
<p>然后就调用 task 子模块提供的 suspend_current_and_run_next 函数可以暂停当前任务，并切换到下一个任务</p>
<p>这一章完成后，一个应用程序可以主动交出CPU的使用权，这样一来，它需要等待某个资源的时候，CPU就可以去执行其他程序了</p>
<h1 id="第6章"><a href="#第6章" class="headerlink" title="第6章"></a>第6章</h1><p>这一章的概念也看得我很晕</p>
<p>主要是：</p>
<ul>
<li>索引节点和文件有什么关系？</li>
<li>目录和索引节点又有什么关系？</li>
<li>一级索引存在哪里？二级索引指向哪里？</li>
<li>inode和DiskInode是如何映射起来的？</li>
</ul>
<p>因此画了这个示意图：</p>
<p><img src="https://www.notion.so/image/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fba0aca6b-3b67-48e5-ac4d-8a0498157baa%2Fac41c707-8033-4264-a2e7-dc7f81bb8cd9%2F7cbdd5ee-8c18-4cbf-9619-95fb3a5c34dd.png?table=block&id=4859c3ff-a516-4d00-a22a-7a4ce709b080&spaceId=ba0aca6b-3b67-48e5-ac4d-8a0498157baa&width=2000&userId=4604a8da-3e33-4cbd-b5b3-bda19d665487&cache=v2" alt="img"></p>
<p>对于lab，感觉比较难的是理解几个inode之间的关系，比如通过文件名如何查找其对应的inode_id？</p>
<h1 id="第7-8章"><a href="#第7-8章" class="headerlink" title="第7~8章"></a>第7~8章</h1><p>终于要结束了</p>
<p>第8章的概念比较好理解，对我来说比较难的是理解lab里面死锁检测算法的含义</p>
<p>一开始写的时候只考虑了能否解开一个锁，总感觉哪里不对。后来发现，其实要考虑能否解开所有的锁，因为解锁的顺序是要考虑的，如果只考虑能否解开一个锁，那么这个解锁顺序可能无法实现。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/15/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-w6rsty/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/15/2024%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93-w6rsty/" class="post-title-link" itemprop="url">2024开源操作系统训练营第一阶段总结-w6rsty</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-15 18:47:55" itemprop="dateCreated datePublished" datetime="2024-05-15T18:47:55+00:00">2024-05-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-11 07:51:25" itemprop="dateModified" datetime="2024-11-11T07:51:25+00:00">2024-11-11</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>第二次参加训练营了，之前已经写过一段时间的Rust了，题目和记忆中差不太多很快就做完了。<br>遗憾是每次参加训练营的时候，学校的安排都很紧，希望这次有时间能进三阶段吧</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/05/15/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%8A%A5%E5%91%8A%E6%80%BB%E7%BB%93-page0egap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/blog/2024/05/15/2024%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%8A%A5%E5%91%8A%E6%80%BB%E7%BB%93-page0egap/" class="post-title-link" itemprop="url">2024春夏季开源操作系统训练营第一阶段报告总结--page0egap</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-15 16:21:12" itemprop="dateCreated datePublished" datetime="2024-05-15T16:21:12+00:00">2024-05-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-11-11 07:51:25" itemprop="dateModified" datetime="2024-11-11T07:51:25+00:00">2024-11-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/reports/" itemprop="url" rel="index"><span itemprop="name">reports</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="第一阶段总结"><a href="#第一阶段总结" class="headerlink" title="第一阶段总结"></a>第一阶段总结</h1><p>很早听闻Rust是一个“内存安全”的语言，出于好奇，我从去年就开始接触Rust，Rustlings也是我最开始学习Rust使用过的教程之一。因为之前写过一遍，这次重新再写速度快很多。然而完成的过程中，还是发现有些语法不常用到，很容易遗忘。比如结构体初始化可以使用已有变量的内容，这个地方我写Rust的时候几乎没有用到。</p>
<p>相比于之前的rustlings，新的rustlings增加了算法这一个章节。通过完成基本的数据结构，我们可以比较好的了解rust在写底层的数据结构的时候会遇到的困难，特别是rust在操作链表时的“不自由”。由于所有权的问题，链表等在C和C++常用的指针修改操作会非常的痛苦。小的技巧是我们可以用Option来类似于进行指针的操作，使用Option实现方法take和insert来进行内部修改。</p>
<p>Rust的包管理器Cargo相比于C++的Cmake对用户很友好，虽然Rust现阶段的工具库并没有像Java一样丰富，但一般Rust的库都会有比较好的文档说明，所以一般库的质量还是有保障的。</p>
<p>总之，我觉得Rust是一个非常有前景的语言。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/blog/page/15/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/blog/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/53/">53</a><a class="extend next" rel="next" href="/blog/page/17/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rcore-os Group</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>


  















  

  

  

</body>
</html>
