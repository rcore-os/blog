<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/blog/lib/animate-css/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rcore-os.github.io","root":"/blog/","scheme":"Muse","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}}};
  </script>

  <meta name="description" content="rcore第二阶段学习心得以下是针对 rCore 操作系统各个技术方向的详细扩展叙述： 1. 应用程序与基本执行环境rCore 的应用程序执行环境构建在硬件抽象层（HAL）之上，其核心依赖 RustSBI 提供的引导和硬件初始化服务。RustSBI 在启动阶段完成以下关键任务：初始化 CPU 核心、配置物理内存保护区域（如设置 PMP 寄存器）、启用时钟中断和外部设备中断（如 UART 串口）。应">
<meta property="og:type" content="article">
<meta property="og:title" content="&lt;2025春夏季开源操作系统训练营第二阶段总结报告-1430329301Lsj&gt;">
<meta property="og:url" content="http://rcore-os.github.io/blog/2025/05/05/2025%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-1430329301Lsj/index.html">
<meta property="og:site_name" content="rcore-os Blog">
<meta property="og:description" content="rcore第二阶段学习心得以下是针对 rCore 操作系统各个技术方向的详细扩展叙述： 1. 应用程序与基本执行环境rCore 的应用程序执行环境构建在硬件抽象层（HAL）之上，其核心依赖 RustSBI 提供的引导和硬件初始化服务。RustSBI 在启动阶段完成以下关键任务：初始化 CPU 核心、配置物理内存保护区域（如设置 PMP 寄存器）、启用时钟中断和外部设备中断（如 UART 串口）。应">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-05-05T00:06:33.000Z">
<meta property="article:modified_time" content="2025-06-04T14:25:37.601Z">
<meta property="article:author" content="rcore-os Group">
<meta property="article:tag" content="author:1430329301Lsj">
<meta property="article:tag" content="repo:https:&#x2F;&#x2F;github.com&#x2F;LearningOS&#x2F;2024a-rcore-1430329301Lsj">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rcore-os.github.io/blog/2025/05/05/2025%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-1430329301Lsj/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title><2025春夏季开源操作系统训练营第二阶段总结报告-1430329301Lsj> | rcore-os Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">rcore-os Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#rcore第二阶段学习心得"><span class="nav-number">1.</span> <span class="nav-text">rcore第二阶段学习心得</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-应用程序与基本执行环境"><span class="nav-number">1.0.1.</span> <span class="nav-text">1. 应用程序与基本执行环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-批处理系统"><span class="nav-number">1.0.2.</span> <span class="nav-text">2. 批处理系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-多道程序与分时多任务"><span class="nav-number">1.0.3.</span> <span class="nav-text">3. 多道程序与分时多任务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-地址空间"><span class="nav-number">1.0.4.</span> <span class="nav-text">4. 地址空间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-进程与进程管理"><span class="nav-number">1.0.5.</span> <span class="nav-text">5. 进程与进程管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-文件系统与重定向"><span class="nav-number">1.0.6.</span> <span class="nav-text">6. 文件系统与重定向</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-进程间通信（IPC）"><span class="nav-number">1.0.7.</span> <span class="nav-text">7. 进程间通信（IPC）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-并发机制"><span class="nav-number">1.0.8.</span> <span class="nav-text">8. 并发机制</span></a></li></ol></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rcore-os Group</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">714</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">625</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2025/05/05/2025%E6%98%A5%E5%A4%8F%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-1430329301Lsj/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          <2025春夏季开源操作系统训练营第二阶段总结报告-1430329301Lsj>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2025-05-05 00:06:33" itemprop="dateCreated datePublished" datetime="2025-05-05T00:06:33+00:00">2025-05-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-06-04 14:25:37" itemprop="dateModified" datetime="2025-06-04T14:25:37+00:00">2025-06-04</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="rcore第二阶段学习心得"><a href="#rcore第二阶段学习心得" class="headerlink" title="rcore第二阶段学习心得"></a>rcore第二阶段学习心得</h1><p>以下是针对 rCore 操作系统各个技术方向的详细扩展叙述：</p>
<h3 id="1-应用程序与基本执行环境"><a href="#1-应用程序与基本执行环境" class="headerlink" title="1. 应用程序与基本执行环境"></a><strong>1. 应用程序与基本执行环境</strong></h3><p>rCore 的应用程序执行环境构建在硬件抽象层（HAL）之上，其核心依赖 <strong>RustSBI</strong> 提供的引导和硬件初始化服务。RustSBI 在启动阶段完成以下关键任务：初始化 CPU 核心、配置物理内存保护区域（如设置 PMP 寄存器）、启用时钟中断和外部设备中断（如 UART 串口）。应用程序以 <strong>静态链接的 ELF 格式</strong> 加载到内存中，内核解析 ELF 文件头获取代码段（<code>.text</code>）、数据段（<code>.data</code>）和未初始化数据段（<code>.bss</code>）的虚拟地址，并为其分配物理页帧，建立虚拟地址到物理地址的映射。  </p>
<p>用户程序运行在 <strong>RISC-V U 模式（用户态）</strong>，通过 <code>ecall</code> 指令触发特权级切换到 S 模式（监管态）执行系统调用。内核在初始化用户环境时，需配置用户栈空间（如分配 8KB 栈内存）并设置 <strong>Trap 上下文</strong>，确保异常处理时能正确保存和恢复寄存器状态。系统调用参数传递遵循 RISC-V ABI 规范：系统调用号存入 <code>a7</code>，参数依次存入 <code>a0-a6</code>，返回值通过 <code>a0</code> 返回。例如，<code>sys_write</code> 调用时，用户程序将文件描述符、缓冲区地址和长度分别存入 <code>a0</code>、<code>a1</code>、<code>a2</code>，内核通过 <code>a0</code> 返回实际写入的字节数。  </p>
<p>为确保安全性，内核通过 <strong>内存保护机制</strong> 阻止用户程序直接访问内核空间。例如，用户程序若尝试访问高于 <code>0x80000000</code> 的内核地址，将触发页错误异常（<code>scause=13</code>），内核根据异常类型终止进程或按需分配物理页。</p>
<hr>
<h3 id="2-批处理系统"><a href="#2-批处理系统" class="headerlink" title="2. 批处理系统"></a><strong>2. 批处理系统</strong></h3><p>批处理系统的核心设计是 <strong>顺序执行多个用户程序</strong>，每个程序独占 CPU 直至完成。内核在编译阶段将多个应用程序的 ELF 文件链接到内核镜像中，并在固定物理地址（如 <code>0x80400000</code>）依次加载。程序加载时，内核执行以下步骤：  </p>
<ol>
<li><strong>内存清零</strong>：清除前一程序残留的数据，防止信息泄漏。  </li>
<li><strong>页表隔离</strong>：为每个程序创建独立的页表，仅映射其代码段、数据段和用户栈，避免越界访问。  </li>
<li><strong>上下文初始化</strong>：设置程序的入口地址（ELF 的 <code>entry</code> 字段）和初始栈指针（<code>sp</code> 指向用户栈顶部）。  </li>
</ol>
<p>当程序主动调用 <code>sys_exit</code> 或发生致命错误（如非法指令）时，内核通过 <code>TaskManager</code> 切换到下一程序。任务切换的关键在于保存当前程序的 <strong>任务上下文（TaskContext）</strong>，包括 <code>ra</code>（返回地址）、<code>sp</code>（栈指针）和 <code>s0-s11</code>（保留寄存器），并通过汇编函数 <code>__switch</code> 切换到目标程序的上下文。批处理系统需确保 <strong>原子性切换</strong>，即在切换过程中屏蔽中断（通过 <code>sstatus.SIE</code> 位），防止时钟中断导致状态不一致。</p>
<hr>
<h3 id="3-多道程序与分时多任务"><a href="#3-多道程序与分时多任务" class="headerlink" title="3. 多道程序与分时多任务"></a><strong>3. 多道程序与分时多任务</strong></h3><p>分时多任务通过 <strong>时间片轮转算法</strong> 实现 CPU 资源共享。内核为每个任务维护一个 <strong>任务控制块（TaskControlBlock, TCB）</strong>，包含以下元数据：  </p>
<ul>
<li><strong>任务状态</strong>：运行（Running）、就绪（Ready）、阻塞（Blocked）。  </li>
<li><strong>时间片计数器</strong>：记录剩余时间片长度（如 10ms）。  </li>
<li><strong>优先级</strong>：用于调度决策（如实时任务优先级高于普通任务）。  </li>
<li><strong>上下文信息</strong>：包括寄存器快照和页表地址（<code>satp</code> 值）。  </li>
</ul>
<p>时钟中断（通过 <code>sie.STIE</code> 使能）触发调度器执行以下流程：  </p>
<ol>
<li>递减当前任务的时间片计数器，若归零则标记为就绪状态。  </li>
<li>从就绪队列中选择下一个任务（如按优先级或轮询策略）。  </li>
<li>调用 <code>__switch</code> 切换上下文，并更新 <code>satp</code> 以切换地址空间。  </li>
</ol>
<p><strong>协作式调度</strong> 依赖任务主动调用 <code>sys_yield</code>，适用于 I/O 密集型任务减少切换开销；<strong>抢占式调度</strong> 则通过中断强制切换，适合 CPU 密集型任务提升吞吐量。内核需处理 <strong>临界区竞争</strong>，例如在修改任务队列时关闭中断，防止并发修改导致数据结构损坏。</p>
<hr>
<h3 id="4-地址空间"><a href="#4-地址空间" class="headerlink" title="4. 地址空间"></a><strong>4. 地址空间</strong></h3><p>地址空间通过 <strong>Sv39 分页机制</strong> 实现虚拟内存管理，支持 512GB 的虚拟地址范围。虚拟地址被划分为三级页表索引（VPN[2]、VPN[1]、VPN[0]），每级页表包含 512 个条目（8 字节/条目）。内核维护 <strong>全局页帧分配器</strong>，按需分配物理页帧并更新页表条目（PTE）的权限位（如 <code>R/W/X</code> 和 <code>U</code> 位）。  </p>
<p>用户程序访问虚拟地址时，若触发缺页异常（<code>scause=12/13/15</code>），内核执行以下处理：  </p>
<ol>
<li>检查访问地址是否合法（如位于用户代码段或堆栈范围内）。  </li>
<li>分配物理页帧，建立虚拟地址到物理地址的映射。  </li>
<li>刷新 TLB（通过 <code>sfence.vma</code> 指令），确保后续访问使用新页表。  </li>
</ol>
<p>内核自身采用 <strong>恒等映射</strong>（虚拟地址等于物理地址），简化直接内存访问（如操作外设寄存器）。用户程序通过动态映射访问特定设备（如 MMIO 区域），需在内核中注册设备内存范围并配置页表权限（如设置为不可执行）。</p>
<hr>
<h3 id="5-进程与进程管理"><a href="#5-进程与进程管理" class="headerlink" title="5. 进程与进程管理"></a><strong>5. 进程与进程管理</strong></h3><p>进程是资源分配的基本单位，其控制块（PCB）包含以下信息：  </p>
<ul>
<li><strong>进程标识符（PID）</strong>：唯一标识进程的整数。  </li>
<li><strong>地址空间</strong>：指向页表的指针（<code>satp</code> 值）和内存映射信息。  </li>
<li><strong>文件描述符表</strong>：记录打开的文件、管道或设备。  </li>
<li><strong>父子关系</strong>：父进程 PID 和子进程链表。  </li>
</ul>
<p><strong>进程创建</strong> 通过 <code>fork</code> 系统调用实现，内核复制父进程的地址空间（写时复制优化）和文件描述符表，并为子进程分配新的 PID。<code>exec</code> 系统调用则替换当前进程的地址空间，加载新程序的代码和数据。  </p>
<p><strong>进程调度</strong> 基于状态机模型：  </p>
<ul>
<li><strong>运行 → 就绪</strong>：时间片耗尽或被高优先级任务抢占。  </li>
<li><strong>运行 → 阻塞</strong>：等待 I/O 完成或信号量资源。  </li>
<li><strong>阻塞 → 就绪</strong>：资源可用或事件触发。  </li>
</ul>
<p>进程退出时，内核回收其物理内存、关闭打开的文件，并通过 <code>waitpid</code> 通知父进程回收终止状态。若父进程已终止，子进程由 <strong>init 进程</strong> 接管以避免僵尸进程。</p>
<hr>
<h3 id="6-文件系统与重定向"><a href="#6-文件系统与重定向" class="headerlink" title="6. 文件系统与重定向"></a><strong>6. 文件系统与重定向</strong></h3><p>rCore 的虚拟文件系统（VFS）抽象了 <strong>文件、目录和设备</strong> 的统一接口，支持以下操作：  </p>
<ul>
<li><strong>文件读写</strong>：通过 <code>File trait</code> 的 <code>read</code> 和 <code>write</code> 方法实现，具体由设备驱动（如 UART）或块设备（如 virtio-blk）完成。  </li>
<li><strong>目录管理</strong>：维护目录项（dentry）链表，支持 <code>mkdir</code> 和 <code>readdir</code> 操作。  </li>
</ul>
<p><strong>重定向</strong> 通过复制文件描述符实现。例如，执行 <code>echo hello &gt; output.txt</code> 时，shell 进程执行以下步骤：  </p>
<ol>
<li>打开 <code>output.txt</code> 并获取文件描述符 <code>fd</code>。  </li>
<li>调用 <code>sys_dup</code> 复制 <code>fd</code> 到标准输出（<code>fd=1</code>）。  </li>
<li>子进程继承修改后的文件描述符表，<code>sys_write</code> 输出到文件而非控制台。  </li>
</ol>
<p>文件系统通过 <strong>页缓存</strong> 优化性能，将频繁访问的数据缓存在内存中，减少磁盘 I/O 操作。索引节点（inode）记录文件的元数据（如大小、权限和物理块地址），并通过 <strong>日志机制</strong> 确保崩溃一致性。</p>
<hr>
<h3 id="7-进程间通信（IPC）"><a href="#7-进程间通信（IPC）" class="headerlink" title="7. 进程间通信（IPC）"></a><strong>7. 进程间通信（IPC）</strong></h3><p>IPC 机制包括以下实现方式：  </p>
<ul>
<li><strong>共享内存</strong>：内核分配物理页帧，并映射到多个进程的地址空间。进程通过信号量或自旋锁同步访问。  </li>
<li><strong>管道</strong>：基于环形缓冲区的 FIFO 队列，内核维护 <code>pipe</code> 结构体记录读写位置和等待队列。<code>sys_pipe</code> 创建管道后返回两个文件描述符（读端和写端），进程通过 <code>read</code> 和 <code>write</code> 系统调用传输数据。  </li>
<li><strong>信号</strong>：内核为每个进程维护信号处理函数表。当进程收到信号（如 <code>SIGKILL</code>）时，内核修改其 Trap 上下文，强制跳转到注册的处理函数。信号处理完成后，通过 <code>sigreturn</code> 系统调用恢复原执行流程。  </li>
</ul>
<p><strong>消息队列</strong> 是另一种 IPC 方式，内核维护消息缓冲区，进程通过 <code>msgsnd</code> 和 <code>msgrcv</code> 发送/接收结构化数据，支持阻塞和非阻塞模式。</p>
<hr>
<h3 id="8-并发机制"><a href="#8-并发机制" class="headerlink" title="8. 并发机制"></a><strong>8. 并发机制</strong></h3><p>内核并发通过以下机制管理：  </p>
<ul>
<li><strong>自旋锁（SpinLock）</strong>：通过原子指令（如 <code>amoswap</code>）实现忙等待，适用于短期临界区（如修改任务队列）。使用前需关闭中断（<code>sstatus.SIE = 0</code>），防止死锁。  </li>
<li><strong>互斥锁（Mutex）</strong>：在锁竞争时让出 CPU，将当前任务加入阻塞队列，切换其他任务执行。解锁时唤醒等待任务。  </li>
<li><strong>条件变量（Condvar）</strong>：与互斥锁配合使用，通过 <code>wait</code> 释放锁并阻塞，<code>notify</code> 唤醒等待任务。适用于生产者-消费者模型。  </li>
</ul>
<p>用户态线程（协程）通过 <strong>异步运行时</strong> 实现，内核提供轻量级上下文切换（如 <code>swapcontext</code>）和非阻塞 I/O 系统调用（如 <code>read_async</code>）。Rust 的 <code>async/await</code> 语法糖将协程编译为状态机，运行时调度器根据事件（如 I/O 完成）切换协程执行。  </p>
<p><strong>内存安全</strong> 通过 Rust 的所有权系统和 <code>Send</code>/<code>Sync</code> trait 保障。<code>Send</code> 允许数据跨线程转移所有权，<code>Sync</code> 允许数据被多线程共享引用。编译器静态检查数据竞争，确保并发代码的安全性</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/author-1430329301Lsj/" rel="tag"># author:1430329301Lsj</a>
              <a href="/blog/tags/repo-https-github-com-LearningOS-2024a-rcore-1430329301Lsj/" rel="tag"># repo:https://github.com/LearningOS/2024a-rcore-1430329301Lsj</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2025/05/04/Lfan-ke%EF%BC%9ArCore%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="prev" title="rCore学习笔记">
      <i class="fa fa-chevron-left"></i> rCore学习笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2025/05/05/2025%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E6%80%BB%E7%BB%93-%E5%88%98%E8%BD%B6%E5%87%A1/" rel="next" title="2025开源操作系统训练营总结-刘轶凡">
      2025开源操作系统训练营总结-刘轶凡 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rcore-os Group</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>


  















  

  

  

</body>
</html>
