---
title: 2024春季开源操作系统训练营第一阶段总结报告-z071230116
date: 2024-06-01 22:12:54
categories:
    - report
tags:
    -author:z071230116
    - repo:https://github.com/LearningOS/rust-rustlings-2024-spring-z071230116

---

#


<!-- more -->

# 第一阶段

本阶段主要学习rust语法，前100题分模块联系rust基础，遇到的困难主要是rust 生命周期，对函数调用时的说所有权转移不熟悉，被编译器毒打。宏模块也是比较难理解，虽然完成了对应的联系，但是编写宏和阅读宏代码还是不熟练。在后面10道算法题上，学习了rust 链表，这块儿阅读了rust 语言圣经里面[“手把手带你实现链表”](https://course.rs/too-many-lists/intro.html)，将链表指针用Box封装，将不定长的数据放到堆上，使得链表结构统一，节点大小确定。

在本阶段学习了基础语法，对于标准库的函数、线程spawn、变量回收Drop、并发Arc等还是不熟练，需要后续继续深入学习。



# 第二阶段

本阶段学习rcore，理解操作系统从rustsbi开始的搭建过程，学习了RISC-V体系下代码连接过程、如何进行特权级切换、系统调用实现、虚拟内存管理、以及支持并发等，前两章主要是学习基础知识，在理解问题上同步看[rCore-Tutorial-Book-v3](https://rcore-os.cn/rCore-Tutorial-Book-v3/index.html) 能够理解的更透彻。第一章主要学习移除rust标准库之后，学习OS链接过程、rustsbi、硬件执行.，通过rustsbi 提供的接口，实现了println! 宏，一步一步的跟着指引完成了ch1。第二章学习特权级切换，Trap上下文保存与恢复，通过csrrw 指令切换用户栈/内核栈，然后保存对应的寄存器。前两章需要部分RISC-V 的硬件知识。

第三章开始进入多道程序，TaskManager  将程序分别加载到不同的地址空间，在链接阶段确定每个程序的装载位置。同时确定了变量和常量分离的编程风格，需要依据第二章的lab1实验，开始写sys_task_info系统调用，主要是要增加在task结构体系统调用次数的数组，在每次系统调用的时候增加数组对应位置的计数。在数据写入的时候，参照了sys_get_time，对传入的指针进行写数据。

第四章开始学习虚拟地址空间，学习SV39分页机制，将地址分为虚拟地址和物理地址，虚拟地址划分为虚拟页号+页内偏移page_offset，物理地址划分为 页帧号+页内偏移page_offset，其中两个page_offset对应数值一样。虚拟页号和页帧通过页表进行转换。在开启虚拟内存管理之后，应用看到的是虚拟地址，通过MMU单元进行转换，**而内核使用对等映射**，已开始阅读学习文档不仔细，没有理解内核如何读取应用数据，导致本章花费不少时间。在sys_get_time和sys_task_info上，需要进行虚拟地址转换，还会出现跨页的情况，所以是按照字节逐步进行映射和写入。 mmap 和 munmap两个系统调用，查询页表项，然后调用插入/删除页表项函数。同时本章开始解析ELF文件，然后加载到具体的内存地址。对跳板页面没有理解清楚，后续再继续学习。

第五章开始学习进程概念，将进程概念实现为具体的结构体，保持变量和常量分离的编程风格。sys_spawn 系统调用逻辑上和fork+exec等同，只是不再复制父进程，直接将新的代码函数转载到子进程的地址空间。

第六章学习文件系统，建立将磁盘划分为固定大小的扇区，通过块设备进行磁盘的读写，并依据磁盘缓存层将磁盘数据放在内存进行缓存。easy-fs 文件系统，通过超级块标记各个连续块的分布，包含inode map块，inode 块，数据map块，数据块, 通过查询保存文件项的磁盘inode（根目录inode），找到对应的文件inode编号，然后读取文件Inode。

第八章学习线程（并发），将进程拆分为占用资源的进程和独立调度的线程。最开始创建的进程（父进程）的线程id设为0，标志是主线程。为线程模型创建结构体，TaskControlBlock，采用常量和变量分离的模式。在lab5里进行死锁检测时，区分互斥锁和信号量进行分别处理，同时互斥锁又分为阻塞型和非阻塞型。非阻塞型是自旋锁，当同一个线程进行两次申请锁时，及进入死锁。非阻塞型需要检查是否又阻塞状态的进程拿到了该锁。对于信号量采用银行家算法，进行分析，前提是获取到need、available、allocated矩阵。



经过5个实验的学习，初步掌握了如何在裸机上跑OS，如何进行编写系统调用，其中上下文切换需要掌握硬件知识，在过程中好几次肝到1点，在折磨中成长。感谢训练营的老师、助教们提供的学习资源~
