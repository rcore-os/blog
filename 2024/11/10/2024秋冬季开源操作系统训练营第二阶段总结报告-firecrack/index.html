<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">


<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">
  
  <link rel="stylesheet" href="/blog/lib/animate-css/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"rcore-os.github.io","root":"/blog/","scheme":"Muse","version":"8.0.0-rc.4","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}}};
  </script>

  <meta name="description" content="专业阶段总结四个抽象 执行环境 进程 地址空间 文件五个特征 虚拟化 内存地址虚拟化 内存大小虚拟化：通过引入硬盘空间、 CPU虚拟化：通过分时以及快速切换   并发 异步 共享 持久  程序编译流程 预处理：宏展开 编译器： ——&gt; 汇编语言 汇编器：——&gt; 目标代码 链接器：——&gt; 可执行文件  不使用标准库#![no_std]添加在文件开头 禁用默认的main#![no_m">
<meta property="og:type" content="article">
<meta property="og:title" content="2024秋冬季开源操作系统训练营第二阶段总结报告_firecrack">
<meta property="og:url" content="http://rcore-os.github.io/blog/2024/11/10/2024%E7%A7%8B%E5%86%AC%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-firecrack/index.html">
<meta property="og:site_name" content="rcore-os Blog">
<meta property="og:description" content="专业阶段总结四个抽象 执行环境 进程 地址空间 文件五个特征 虚拟化 内存地址虚拟化 内存大小虚拟化：通过引入硬盘空间、 CPU虚拟化：通过分时以及快速切换   并发 异步 共享 持久  程序编译流程 预处理：宏展开 编译器： ——&gt; 汇编语言 汇编器：——&gt; 目标代码 链接器：——&gt; 可执行文件  不使用标准库#![no_std]添加在文件开头 禁用默认的main#![no_m">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2024-11-10T21:26:10.000Z">
<meta property="article:modified_time" content="2025-05-09T08:51:47.977Z">
<meta property="article:author" content="rcore-os Group">
<meta property="article:tag" content="[object Object]">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://rcore-os.github.io/blog/2024/11/10/2024%E7%A7%8B%E5%86%AC%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-firecrack/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>2024秋冬季开源操作系统训练营第二阶段总结报告_firecrack | rcore-os Blog</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <main class="main">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader">
        <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
        <span class="toggle-line toggle-line-first"></span>
        <span class="toggle-line toggle-line-middle"></span>
        <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">rcore-os Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <section class="post-toc-wrap sidebar-panel">
          <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#专业阶段总结"><span class="nav-number">1.</span> <span class="nav-text">专业阶段总结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#四个抽象"><span class="nav-number">1.1.</span> <span class="nav-text">四个抽象</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五个特征"><span class="nav-number">1.2.</span> <span class="nav-text">五个特征</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#程序编译流程"><span class="nav-number">1.3.</span> <span class="nav-text">程序编译流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不使用标准库"><span class="nav-number">1.4.</span> <span class="nav-text">不使用标准库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#禁用默认的main"><span class="nav-number">1.5.</span> <span class="nav-text">禁用默认的main</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#qemu启动流程"><span class="nav-number">1.6.</span> <span class="nav-text">qemu启动流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GDB调试"><span class="nav-number">1.7.</span> <span class="nav-text">GDB调试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查看内存"><span class="nav-number">1.7.1.</span> <span class="nav-text">查看内存</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#打印寄存器"><span class="nav-number">1.7.2.</span> <span class="nav-text">打印寄存器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#特权级切换"><span class="nav-number">1.8.</span> <span class="nav-text">特权级切换</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#硬件"><span class="nav-number">1.8.1.</span> <span class="nav-text">硬件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#软件（操作系统）"><span class="nav-number">1.8.2.</span> <span class="nav-text">软件（操作系统）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#虚拟内存"><span class="nav-number">1.9.</span> <span class="nav-text">虚拟内存</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#地址转换"><span class="nav-number">1.9.1.</span> <span class="nav-text">地址转换</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#单级页表"><span class="nav-number">1.9.1.1.</span> <span class="nav-text">单级页表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#多级页表"><span class="nav-number">1.9.1.2.</span> <span class="nav-text">多级页表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#缺页异常"><span class="nav-number">1.9.1.3.</span> <span class="nav-text">缺页异常</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#引入TLB和cache"><span class="nav-number">1.9.2.</span> <span class="nav-text">引入TLB和cache</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#TLB"><span class="nav-number">1.9.2.1.</span> <span class="nav-text">TLB</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TLB缺失"><span class="nav-number">1.9.2.2.</span> <span class="nav-text">TLB缺失</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TLB的写入"><span class="nav-number">1.9.2.3.</span> <span class="nav-text">TLB的写入</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#进程调度"><span class="nav-number">1.10.</span> <span class="nav-text">进程调度</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#批处理系统的调度"><span class="nav-number">1.10.1.</span> <span class="nav-text">批处理系统的调度</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#约束条件"><span class="nav-number">1.10.1.1.</span> <span class="nav-text">约束条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#性能指标"><span class="nav-number">1.10.1.2.</span> <span class="nav-text">性能指标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#先来先服务FIFO"><span class="nav-number">1.10.1.3.</span> <span class="nav-text">先来先服务FIFO</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#最短作业优先SJF"><span class="nav-number">1.10.1.4.</span> <span class="nav-text">最短作业优先SJF</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#交互式系统的调度"><span class="nav-number">1.10.2.</span> <span class="nav-text">交互式系统的调度</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#约束条件-1"><span class="nav-number">1.10.2.1.</span> <span class="nav-text">约束条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#性能指标-1"><span class="nav-number">1.10.2.2.</span> <span class="nav-text">性能指标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#最短完成时间优先（STCF）"><span class="nav-number">1.10.2.3.</span> <span class="nav-text">最短完成时间优先（STCF）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#基于时间片的轮转"><span class="nav-number">1.10.2.4.</span> <span class="nav-text">基于时间片的轮转</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#通用计算机系统的调度"><span class="nav-number">1.10.3.</span> <span class="nav-text">通用计算机系统的调度</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#约束条件-2"><span class="nav-number">1.10.3.1.</span> <span class="nav-text">约束条件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#固定优先级的多级无反馈队列Multi-level-Feedback-Queue"><span class="nav-number">1.10.3.2.</span> <span class="nav-text">固定优先级的多级无反馈队列Multi-level Feedback Queue</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#可降低优先级的多级反馈队列"><span class="nav-number">1.10.3.3.</span> <span class="nav-text">可降低优先级的多级反馈队列</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </section>
      <!--/noindex-->

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">rcore-os Group</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">611</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">45</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">557</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </section>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </header>

      
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div id="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


      <div class="main-inner">
        

        <div class="content post posts-expand">
          

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://rcore-os.github.io/blog/2024/11/10/2024%E7%A7%8B%E5%86%AC%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-firecrack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/avatar.gif">
      <meta itemprop="name" content="rcore-os Group">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rcore-os Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          2024秋冬季开源操作系统训练营第二阶段总结报告_firecrack
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-11-10 21:26:10" itemprop="dateCreated datePublished" datetime="2024-11-10T21:26:10+00:00">2024-11-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-05-09 08:51:47" itemprop="dateModified" datetime="2025-05-09T08:51:47+00:00">2025-05-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/2024%E7%A7%8B%E5%86%AC%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5/" itemprop="url" rel="index"><span itemprop="name">2024秋冬季开源操作系统训练营</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="专业阶段总结"><a href="#专业阶段总结" class="headerlink" title="专业阶段总结"></a>专业阶段总结</h1><h2 id="四个抽象"><a href="#四个抽象" class="headerlink" title="四个抽象"></a>四个抽象</h2><ul>
<li>执行环境</li>
<li>进程</li>
<li>地址空间</li>
<li>文件<h2 id="五个特征"><a href="#五个特征" class="headerlink" title="五个特征"></a>五个特征</h2></li>
<li>虚拟化<ul>
<li>内存地址虚拟化</li>
<li>内存大小虚拟化：通过引入硬盘空间、</li>
<li>CPU虚拟化：通过分时以及快速切换</li>
</ul>
</li>
<li>并发</li>
<li>异步</li>
<li>共享</li>
<li>持久</li>
</ul>
<h2 id="程序编译流程"><a href="#程序编译流程" class="headerlink" title="程序编译流程"></a>程序编译流程</h2><ul>
<li>预处理：宏展开</li>
<li>编译器： ——&gt; 汇编语言</li>
<li>汇编器：——&gt; 目标代码</li>
<li>链接器：——&gt; 可执行文件</li>
</ul>
<h2 id="不使用标准库"><a href="#不使用标准库" class="headerlink" title="不使用标准库"></a>不使用标准库</h2><p><code>#![no_std]</code>添加在文件开头</p>
<h2 id="禁用默认的main"><a href="#禁用默认的main" class="headerlink" title="禁用默认的main"></a>禁用默认的main</h2><p><code>#![no_main]</code></p>
<h2 id="qemu启动流程"><a href="#qemu启动流程" class="headerlink" title="qemu启动流程"></a>qemu启动流程</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">qemu-system-riscv64 \</span><br><span class="line">    -machine virt \</span><br><span class="line">    -nographic \</span><br><span class="line">    -bios ..&#x2F;bootloader&#x2F;rustsbi-qemu.bin \</span><br><span class="line">    -device loader,file&#x3D;target&#x2F;riscv64gc-unknown-none-elf&#x2F;release&#x2F;os.bin,addr&#x3D;0x80200000</span><br></pre></td></tr></table></figure>
<ul>
<li>virt 硬件平台上，物理内存的起始物理地址为 0x80000000 ，物理内存的默认大小为 128MiB，所以物理地址空间为[0x80000000,0x88000000)</li>
<li>启动时先将sbi文件加载到0x8000 0000, 将os.bin 加载到0x8020 0000</li>
</ul>
<p>计算机启动的三个阶段：</p>
<ol>
<li>CPU固有的一些程序，对应于QEMU就是其自带的一段程序，该程序第一条指令在0x1000处，最后一条指令就是跳转到0x8000 0000 执行bootloader</li>
<li>bootloader 负责一些计算初始化工作后，再跳转到第三程序，对于RUSTSBI第三阶段程序的入口地址固定为0x8020 0000，实际的应用中bootloader会负责将操作系统程序从硬盘加载到该地址</li>
<li>执行os的代码</li>
</ol>
<h2 id="GDB调试"><a href="#GDB调试" class="headerlink" title="GDB调试"></a>GDB调试</h2><h3 id="查看内存"><a href="#查看内存" class="headerlink" title="查看内存"></a>查看内存</h3><p><code>x/nfu addr</code>  </p>
<ul>
<li>n：表示要显示的内存单元的数量。</li>
<li>f：格式，可以是 b（byte）、h（halfword，2字节）、w（word，4字节）、g（giant，8字节）等。</li>
<li>u：显示的格式，可以是 x（十六进制）、d（十进制）、o（八进制）、t（二进制）等。</li>
<li>addr：内存地址。<h3 id="打印寄存器"><a href="#打印寄存器" class="headerlink" title="打印寄存器"></a>打印寄存器</h3><code>p/x $xx</code></li>
</ul>
<h2 id="特权级切换"><a href="#特权级切换" class="headerlink" title="特权级切换"></a>特权级切换</h2><p>S模式下的控制状态寄存器（CSR）</p>
<ul>
<li>sstatus:SPP 等字段给出 Trap 发生之前 CPU 处在哪个特权级（S/U）等信息</li>
<li>sepc：当 Trap 是一个异常的时候，记录 Trap 发生之前执行的最后一条指令的地址</li>
<li>scause: Trap的原因</li>
<li>stval: Trap的附加信息 (例如缺页异常时的虚拟地址)</li>
<li>stvec: Trap处理程序的入口地址</li>
</ul>
<h3 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h3><p>当执行ecall时，硬件的工作：</p>
<ul>
<li>sstatus 的 SPP 字段会被修改为 CPU 当前的特权级（U/S）。</li>
<li>sepc ecall的地址记录在sepc寄存器中</li>
<li>scause/stval 分别会被修改成这次 Trap 的原因以及相关的附加信息。</li>
<li>CPU 会跳转到 stvec 所设置的 Trap 处理入口地址，并将当前特权级设置为 S ，然后从Trap 处理入口地址处开始执行。</li>
</ul>
<p>sret</p>
<ul>
<li>CPU 会将当前的特权级按照 sstatus 的 SPP 字段设置为 U 或者 S ；</li>
<li>CPU 会跳转到 sepc 寄存器指向的那条指令，然后继续执行。<h3 id="软件（操作系统）"><a href="#软件（操作系统）" class="headerlink" title="软件（操作系统）"></a>软件（操作系统）</h3>在内存中存在两个全局变量，分别表示用户栈和内核栈，位于操作系统程序的.bss段<br>从用户栈切换到内核栈，只需要将寄存器sp值进行更改即可</li>
</ul>
<h2 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h2><p>当程序所需空间大于物理内存时怎么办。在没有虚拟内存前一种方法是，程序员对程序手工分段，依次将每段程序装入内存中运行。<br>虚拟存储器与此类似，只是由操作系统每次将正在使用的一部分放入内存，其余存在硬盘上。</p>
<ul>
<li>虚拟存储器大小由处理器位数决定，对32位处理器来说地址范围为$0 \sim FFFF\quad FFFF$，其中某一地址就叫做虚拟地址（VA）</li>
<li>没有使用虚拟地址的系统，其处理器输出的地址直接就是物理地址（PA），而如果使用了虚拟地址，则处理器输出的就是虚拟地址了，其需要通过内存管理单元（MMU）转换成物理地址</li>
<li>优点：使用虚拟地址的一大优点，对于需要同时运行多个程序的系统来说，每个系统都可以随意使用地址空间，不需要考虑地址的限制。以及保护（同一虚拟地址可以转换为不同物理地址）和共享（不同虚拟地址可以转换为统一物理地址）<h3 id="地址转换"><a href="#地址转换" class="headerlink" title="地址转换"></a>地址转换</h3>目前虚拟存储器通常使用请求分页（demand page）的方式实现，将虚拟内存按页划分，典型的是4KB，物理地址空间按同样大小划分，称为frame。<br>对4KB大小的页，页内索引需要12位，即VA[11:0]，称为page offset，剩余部分可以看做是页编号VPN（virtual page number）。相应的PA[11:0]是frame offset，剩余部分PA[:11]是PFN(physical frame number)。从虚拟地址到物理地址的转换时间上就是VPN到PFN的转换。<h4 id="单级页表"><a href="#单级页表" class="headerlink" title="单级页表"></a>单级页表</h4>当要访问的page，没有与物理内存中的某个frame形成映射关系时，即需要的内容不在物理内存中，此时发生缺页异常（page fault），需要将内容从硬盘加载到内存中。<br>操作系统如何知道page和frame的对应关系？目前普遍使用表格存储VPN到PFN的映射，称为页表（page table，PT），一般存放在物理内存中。</li>
<li>每个程序都有一个张页表，页表在物理内存中的首地址存放在页表寄存器中</li>
<li>页表与cache不同，其包含了所有VPN的映射关系</li>
<li>操作系统会在不同进程之间进行切换，在当前进程被替换掉之前，需要保存其状态，对于页表来说只需要保存页表寄存器就好</li>
<li>页表存在于物理内存中，因此一次取数据需要访问两次内存，第一次是访问页表完成VPN到PFN的转换，第二次是用物理地址来访问内存  </li>
</ul>
<p>一张页表存储了所有VPN的映射因此，对32位处理器，其虚拟空间为4GB，假设页大小为4KB，则VPN编号为VA[31:12]共20位，则一个页表有$2^{20}$项，假设每项占32位，则页表大小为4MB。而对64位处理器，一张页表达到了PB大小，这已经超出了物理内存的大小。而且大多数程序也不会用光虚拟空间，只会使用一小部分，页表项大多都是空的。解决方法就是多级页表</p>
<h4 id="多级页表"><a href="#多级页表" class="headerlink" title="多级页表"></a>多级页表</h4><p>通过引入多级页表，页表也无需占用一块连续空间。页表中的一项称为PTE（page table entry）<br>多级页表的引入，使得访问数据需要的访存次数增加</p>
<h4 id="缺页异常"><a href="#缺页异常" class="headerlink" title="缺页异常"></a>缺页异常</h4><p>缺页异常通过是由软件来处理</p>
<ul>
<li>这是因为发生缺页是需要将数据从磁盘搬运到内存，读磁盘所需时间对异常处理程序来说绰绰有余。</li>
<li>处理过程中可能需要进行页替换，使用软件来处理更加灵活，可以按需选择合适的替换策略  </li>
</ul>
<p>发生缺页异常时，如何知道虚拟地址中的一个页在硬盘哪个位置？</p>
<ul>
<li>操作系统会为每个进程的所有页在硬盘中开辟一块空间（swap空间），同时建立一张表保存每个页在硬盘中的位置<br>缺页处理可能会发生页替换，为了保证一致性，对页表项添加一个脏位，此外为了实现LRU替换策略，添加一个使用位，当使用位为1说明该页最近访问过，操作系统会周期性将使用位置0.<br>缺页异常的硬件支持：</li>
<li>缺页发生时，硬件会产生相应的异常，并跳转值异常处理程序</li>
<li>脏位</li>
<li>使用位  </li>
</ul>
<p>除此之外还可以通过在PTE中添加AP来实现访问控制，添加cacheable来表示是否允许被缓存</p>
<h3 id="引入TLB和cache"><a href="#引入TLB和cache" class="headerlink" title="引入TLB和cache"></a>引入TLB和cache</h3><h4 id="TLB"><a href="#TLB" class="headerlink" title="TLB"></a>TLB</h4><p>多级页表节省了页表的存储空间，但是也增加了防存次数。因此引入缓存思想，对最近访问过的PTE（页表项）进行缓存，这个缓存被称为TLB，其本质就是页表的cache。不过其只有时间相关性。<br>现代处理器通常采用二级TLB，第一级是哈佛结构即分为指令TLB和数据TLB，一般全相连，容量不大，第二级则是组相连模式。</p>
<h4 id="TLB缺失"><a href="#TLB缺失" class="headerlink" title="TLB缺失"></a>TLB缺失</h4><p>TLB是页表的一个子集</p>
<ol>
<li>虚拟地址对应的页不在物理内存中，此时页表中对应的PTE是空的，所以TLB中也一定不会有相关信息</li>
<li>虚拟地址对应的页已经在物理内存中，则页表中对应PTE是有效的，但可能该PTE不在TLB中。</li>
</ol>
<p>要解决TLB缺失，本质是从页表中找到相应PTE，将其写入TLB中，这个过程叫Page Table Walk。该过程可以用硬件实现，也可以用软件实现。</p>
<ol>
<li>软件实现：发生缺失时，硬件将产生缺失的虚拟地址保存到一个特定寄存器中，同时产生一个TLB miss 异常，然后执行异常处理程序，这个过程中可能还会出现缺页异常。软件的优点就是灵活，可以调整TLB写入换出的算法。软件实现中，当发生TLB miss时，流水线中的指令需要清空用于执行异常处理程序，有一个流水线清空和恢复的操作，流水线越深，清空的指令越多。</li>
<li>硬件实现：一般由内存管理单元MMU实现。好处就是不需要清空恢复流水线  </li>
</ol>
<p>一种LRU近似算法：假设TLB使用全相连，使用一个计数器每周期加一，计数器宽度为TLB表项数目，当TLB表中的项目需要被替换时，就以此时计数器中的数作为要被换出的表项编号。</p>
<h4 id="TLB的写入"><a href="#TLB的写入" class="headerlink" title="TLB的写入"></a>TLB的写入</h4><p>TLB与页表的一致性。<br>在对物理内存进行页替换时，需要检查被替换页PTE的脏位，如果是1，需要将被替换页内存写回硬盘，如果是0可以直接替换。<br>而引入了TLB后，就产生了TLB中表项与PTE的一致性问题。load和store命令都会先去查看TLB，如果存在对应的项，则会将use bit置1，此外store指令会将脏位变为1，这时TLB与页表就产生了不一致。如果使用写回策略，那么知道该TLB表项被替换才会更新页表，在此之间如果系统发生了页替换，系统可能以为该内存页没有更新而直接覆盖。</p>
<p>解决方法：页替换发生在page fault时，在进行页替换前，先将TLB写回页表，然后再执行替换</p>
<h2 id="进程调度"><a href="#进程调度" class="headerlink" title="进程调度"></a>进程调度</h2><h3 id="批处理系统的调度"><a href="#批处理系统的调度" class="headerlink" title="批处理系统的调度"></a>批处理系统的调度</h3><p>特点：计算为主，少量I/O</p>
<h4 id="约束条件"><a href="#约束条件" class="headerlink" title="约束条件"></a>约束条件</h4><ol>
<li>每个进程同时到达。</li>
<li>进程的执行时间是已知的。</li>
<li>进程在整个执行过程期间很少执行I/O操作。</li>
<li>进程在执行过程中不会被抢占。</li>
</ol>
<h4 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h4><p>周转时间（turn around），即进程完成时间（completion）与进程到达时间（arrival）的差值：<br>$T_{turn} = T_{complete} - T_{arrive}$<br>平均周转：<br>$T_{avg} = \frac{1}{n}\sum T_{turn}$  </p>
<h4 id="先来先服务FIFO"><a href="#先来先服务FIFO" class="headerlink" title="先来先服务FIFO"></a>先来先服务FIFO</h4><p>通常使用队列来实现：</p>
<ul>
<li>就绪队列</li>
<li>阻塞队列</li>
</ul>
<p>优点：</p>
<ul>
<li>实现简单</li>
<li>公平</li>
</ul>
<p>缺点：</p>
<ul>
<li>如果长任务先到，那么短任务会被迫等待很长时间，使得平均周转时间变长</li>
</ul>
<h4 id="最短作业优先SJF"><a href="#最短作业优先SJF" class="headerlink" title="最短作业优先SJF"></a>最短作业优先SJF</h4><p>在约束条件下，如果把平均周转时间作为唯一的性能指标，那么SJF是一个最优调度算法。</p>
<h3 id="交互式系统的调度"><a href="#交互式系统的调度" class="headerlink" title="交互式系统的调度"></a>交互式系统的调度</h3><h4 id="约束条件-1"><a href="#约束条件-1" class="headerlink" title="约束条件"></a>约束条件</h4><ol>
<li>每个进程可不同时间到达。</li>
<li>每个进程的执行时间不同。</li>
<li>进程的执行时间是已知的。</li>
<li>进程在整个执行过程期间会执行I/O操作。</li>
<li>进程在执行过程中会被抢占。</li>
</ol>
<h4 id="性能指标-1"><a href="#性能指标-1" class="headerlink" title="性能指标"></a>性能指标</h4><p>目标是提高用户的交互性体验和减少I/O响应时间<br>响应时间（response time），即从程序到达到第一次被执行的时间</p>
<h4 id="最短完成时间优先（STCF）"><a href="#最短完成时间优先（STCF）" class="headerlink" title="最短完成时间优先（STCF）"></a>最短完成时间优先（STCF）</h4><ul>
<li>在支持抢占式的系统上，可以改善周转时间  </li>
<li>但对于响应时间，FIFO/SJF/STCF都没用特别好的效果<h4 id="基于时间片的轮转"><a href="#基于时间片的轮转" class="headerlink" title="基于时间片的轮转"></a>基于时间片的轮转</h4></li>
<li>每个任务轮流占用CPU一段时间</li>
<li>时间片越短，任务得到响应越快，但存在进行切换开销</li>
<li>任务越多，轮到下一次执行的时间越长，系统平均周转时间也会变长</li>
</ul>
<h3 id="通用计算机系统的调度"><a href="#通用计算机系统的调度" class="headerlink" title="通用计算机系统的调度"></a>通用计算机系统的调度</h3><h4 id="约束条件-2"><a href="#约束条件-2" class="headerlink" title="约束条件"></a>约束条件</h4><ol>
<li>每个进程可不同时间到达。</li>
<li>每个进程的执行时间不同。</li>
<li>进程的启动时间和执行时间是未知的。</li>
<li>进程在整个执行过程期间会执行I/O操作。</li>
<li>进程在执行过程中会被抢占。<h4 id="固定优先级的多级无反馈队列Multi-level-Feedback-Queue"><a href="#固定优先级的多级无反馈队列Multi-level-Feedback-Queue" class="headerlink" title="固定优先级的多级无反馈队列Multi-level Feedback Queue"></a>固定优先级的多级无反馈队列Multi-level Feedback Queue</h4>一般CPU密集型优先级低，I/O密集型优先级高</li>
<li>如果进程PA的优先级 &gt; PB的优先级，抢占并运行PA。</li>
<li>如果进程PA的优先级 = PB的优先级，轮转运行PA和PB。</li>
</ol>
<p>难点：</p>
<ul>
<li>无法预估程序的类型</li>
<li>I/O密集程度多样<h4 id="可降低优先级的多级反馈队列"><a href="#可降低优先级的多级反馈队列" class="headerlink" title="可降低优先级的多级反馈队列"></a>可降低优先级的多级反馈队列</h4></li>
<li>动态调整进程的优先级</li>
<li>操作系统首先需要以优先级的数量来建立多个队列。当然这个数量是一个经验值，比如Linux操作系统设置了140个优先级。</li>
<li>优先级的变化是单向的，一个进程的优先级只会持平/降低</li>
<li>低优先级可能会一直无法拿到CPU，产生饥饿现象</li>
</ul>
<p>如何提升优先级</p>
<ul>
<li>定期统计进程在就绪态/阻塞态的等待时间，等待时间越长，其优先级的提升度就越高</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/object-Object/" rel="tag"># [object Object]</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2024/11/10/2024%E7%A7%8B%E5%86%AC%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-firecrack/" rel="prev" title="2024秋冬季开源操作系统训练营第一阶段总结报告-firecrack">
      <i class="fa fa-chevron-left"></i> 2024秋冬季开源操作系统训练营第一阶段总结报告-firecrack
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2024/11/10/2024%E7%A7%8B%E5%86%AC%E5%AD%A3%E5%BC%80%E6%BA%90%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AE%AD%E7%BB%83%E8%90%A5%E4%B8%80%E4%BA%8C%E9%98%B6%E6%AE%B5%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%E6%8A%A5%E5%91%8A-%E4%BB%A3%E4%BF%8A%E5%8B%83/" rel="next" title="2024秋冬季开源操作系统训练营一二阶段学习总结报告-代俊勃">
      2024秋冬季开源操作系统训练营一二阶段学习总结报告-代俊勃 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



        </div>
        

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rcore-os Group</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/muse.js"></script>


<script src="/blog/js/next-boot.js"></script>


  















  

  

  

</body>
</html>
